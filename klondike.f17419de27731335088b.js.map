{"version":3,"sources":["webpack://klondike/webpack/runtime/chunk loaded","webpack://klondike/./src/css/index.css?2563","webpack://klondike/./src/components/App.tsx","webpack://klondike/./src/components/Container.tsx","webpack://klondike/./src/components/Fireworks.tsx","webpack://klondike/./src/components/GameCanvas.tsx","webpack://klondike/./src/components/Options.tsx","webpack://klondike/./src/components/StackElement.tsx","webpack://klondike/./src/drawing/Card.ts","webpack://klondike/./src/drawing/ColorScheme.ts","webpack://klondike/./src/drawing/Common.ts","webpack://klondike/./src/drawing/FontSize.ts","webpack://klondike/./src/drawing/Layout.ts","webpack://klondike/./src/drawing/Stack.ts","webpack://klondike/./src/hooks/useCanvasSize.ts","webpack://klondike/./src/hooks/useDrawing.ts","webpack://klondike/./src/index.tsx","webpack://klondike/./src/lib/Card.ts","webpack://klondike/./src/lib/Persist.ts","webpack://klondike/./src/lib/Scoring.ts","webpack://klondike/./src/lib/util.ts","webpack://klondike/./src/redux/game-state.ts","webpack://klondike/./src/redux/index.ts","webpack://klondike/./src/redux/init.ts","webpack://klondike/./src/redux/selectors.ts","webpack://klondike/./src/redux/stacks.ts","webpack://klondike/./src/redux/thunks.ts","webpack://klondike/./src/redux/undoable.ts","webpack://klondike/webpack/bootstrap","webpack://klondike/webpack/runtime/compat get default export","webpack://klondike/webpack/runtime/define property getters","webpack://klondike/webpack/runtime/global","webpack://klondike/webpack/runtime/hasOwnProperty shorthand","webpack://klondike/webpack/runtime/make namespace object","webpack://klondike/webpack/runtime/jsonp chunk loading","webpack://klondike/webpack/startup"],"names":["deferred","module","exports","App","newNumber","retrieve","PersistanceType","number","newGameNumber","newType","type","ScoringType","regular","newTheme","theme","ColorSchemeType","dark","dispatch","initializeGame","Provider","store","React","memo","hot","useDispatch","stacks","useSelector","getStacks","overDrawn","getOverDrawn","showing","getShowing","getTheme","score","getScore","getNumber","cssVars","useMemo","colors","colorSchemes","background","color","emptyColor","faceUp","hiddenColor1","hiddenColor2","buttonBorder","cardBorder","black","red","selected","errorColor","showOptions","setShowOptions","useState","handleCloseOptions","useCallback","handleShowOptions","handleNewGame","useEffect","handleMouseDown","e","button","preventDefault","performMoves","handleKeyDown","code","prev","ctrlKey","shiftKey","redo","undo","document","addEventListener","removeEventListener","style","onClose","className","optionsModal","onClick","optionsMask","topBar","title","tabIndex","display","label","String","padStart","game","map","stack","key","index","StackType","waste","stock","ref","useRef","fireworksObj","active","getGameWon","current","FireworksCanvas","ev","stop","destroy","start","fireworks","zIndex","GameCtx","createContext","intersect","evt","pointsRef","nativeEvent","canvas","target","point","x","offsetX","y","offsetY","ctx","getContext","path","keys","isPointInPath","thing","get","GameCanvas","children","rest","Map","clickHandlers","doubleClickHandlers","width","height","handleCanvasRef","useCanvasSize","colorSchemeType","colorScheme","context","useLayoutEffect","initialize","value","events","set","onDoubleClick","delete","handleCanvasDoubleClick","selection","event","handleCanvasClick","id","window","innerWidth","innerHeight","submitCallbacks","Set","OptionCtx","Option","onChange","name","options","min","max","props","newValue","setValue","handleChange","handleSubmit","add","length","htmlFor","option","toString","checked","displayName","typeOptions","vegas","colorSchemeOptions","light","Options","forEach","cb","getType","gameNumber","handleNewNumber","parseInt","handleNewType","handleNewTheme","changeTheme","onSubmit","StackElement","Infinity","gameContext","useContext","drawingOpts","getStackDrawingContext","prop","direction","StackDirection","horizontal","cards","slice","Math","floor","box","space","doubleClickCard","stackCard","clickCard","useDrawing","drawStack","FontSizeType","getBoxPath","radius","smaller","Path2D","dx","dy","dw","dh","moveTo","lineTo","quadraticCurveTo","closePath","getGlyphLocations","card","hidden","cardWidth","cardHeight","getCardDimensions","gutterHeight","getVerticalMarginSize","gutterWidth","getHorizontalMarginSize","cornerWidth","figureOutFontSize","search","Corner","isBig","fontSizes","Regular","cornerValueX","cornerValueY","cornerSuitX","cornerSuitY","measureHeight","suit","positions","glyph","reduce","push","rotated","textAlign","textBaseline","font","pos","ValueType","ace","three","five","nine","jack","queen","king","includes","two","four","six","seven","eight","ten","getTop","getLeft","getTextAlign","getEmptyImageData","clearRect","fillStyle","fillRect","lineWidth","strokeStyle","strokeRect","getImageData","getHiddenImageData","tile","createElement","tileCtx","gradient","createLinearGradient","addColorStop","stroke","save","clip","createPattern","restore","getCardImageData","fill","isRed","translate","rotate","PI","fillText","getErrorImageData","c2","getKey","cardCache","Cards","writeDataToCanvas","data","ctx2","putImageData","drawImage","allFontSizes","Array","from","v","k","measureWidth","text","measureText","searchFontSize","isBigEnough","getStackCardOffsetWidth","getStackCardOffsetHeight","getTopbarBox","horizontalMargin","verticalMargin","topBarBox","stackCardOffsetHeight","usedVerticalSpace","usedHorizontalSpace","maxWidth","maxHeight","DESIRED_RATIO","getStackBox","cardLength","usedWidth","baseX","stackWidth","stackHeight","vertical","foundation","tableau","opts","rect","empty","error","elements","i","drawing","setCanvas","getSize","size","setSize","tid","handleSize","clearTimeout","setTimeout","draw","performCleanup","lastWidth","lastHeight","remove","offline","install","applyUpdate","location","reload","ReactDOM","render","getElementById","SuitType","Object","values","freeze","persist","localStorage","setItem","JSON","stringify","err","init","getItem","parse","ScoreType","getScoreChange","scoringType","scoreType","tableauToFoundation","wasteToFoundation","revealCard","wasteToTableau","foundationToTableau","rnd","s","imul","sumConsecutive","getTopCard","random","sameStack","src","dest","sameSuit","sameCard","sameValue","contains","some","sequential","valueToInt","diamond","heart","isValidFoundationMove","isValidTableauMove","different","gameStateSlice","createSlice","initialState","draws","reducers","state","payload","extraReducers","builder","addCase","addMatcher","action","shiftCards","match","to","actions","incrementDraws","incrementScore","undoable","reducer","middleware","getDefaultMiddleware","immutableCheck","serializableCheck","combineReducers","gameState","configureStore","getGameState","createAction","createSelector","present","getFoundation","filter","getTableau","every","getHiddenCard","acc","topCard","getMovableToFoundation","f","getStock","getWaste","getFoundationStack","_","find","getDraws","getSelection","disallowClickStock","stacksSlice","toStack","fromStack","revealTop","thisStack","selectCard","thisCard","deselectCard","selectedCard","a","moveCards","from_card","findIndex","drawStockCards","reverse","recycleWaste","getState","availableCards","rando","splice","movable","checkAndPerformCardReveal","checkAndPerformFoundationMove","checkpoint","cardSelection","past","future","previous","next","newFuture","newPresent","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","call","m","O","result","chunkIds","fn","priority","notFulfilled","fulfilled","j","n","getter","__esModule","d","definition","o","defineProperty","enumerable","g","globalThis","this","Function","obj","prototype","hasOwnProperty","r","Symbol","toStringTag","installedChunks","604","chunkId","webpackJsonpCallback","parentChunkLoadingFunction","moreModules","runtime","chunkLoadingGlobal","self","bind","__webpack_exports__"],"mappings":"UAAIA,E,SCCJC,EAAOC,QAAU,CAAC,OAAS,wBAAwB,UAAY,0BAA0B,KAAO,0BAA0B,OAAS,wBAAwB,MAAQ,0BAA0B,YAAc,0BAA0B,aAAe,4B,yFCDpP,eAEA,SAEA,SACA,SACA,OACA,SACA,SACA,SACA,SAEMC,EAAgB,KACpB,MAAMC,EAAY,EAAAC,SAAS,EAAAC,gBAAgBC,OAAQ,EAAAC,iBAC7CC,EAAU,EAAAJ,SAAsB,EAAAC,gBAAgBI,KAAM,EAAAC,YAAYC,SAClEC,EAAW,EAAAR,SAA0B,EAAAC,gBAAgBQ,MAAO,EAAAC,gBAAgBC,MAIlF,OAFA,UAAMC,SAAS,EAAAC,eAAe,CAAET,UAASL,YAAWS,cAGlD,gBAAC,EAAAM,SAAQ,CAACC,MAAO,WACf,gBAAC,UAAS,QAKP,EAAAjB,MAET,UAAekB,EAAMC,KAAKnB,I,4EC5B1B,eACA,SACA,SAEA,SACA,SACA,OAEA,SACA,SACA,SACA,SAEA,SACA,SACA,SAuGA,UAAe,EAAAoB,IAAIF,EAAMC,MArGG,KAC1B,MAAML,EAAW,EAAAO,cACXC,EAAS,EAAAC,YAAY,EAAAC,WACrBC,EAAY,EAAAF,YAAY,EAAAG,cACxBC,EAAU,EAAAJ,YAAY,EAAAK,YACtBjB,EAAQ,EAAAY,YAAY,EAAAM,UACpBC,EAAQ,EAAAP,YAAY,EAAAQ,UACpB3B,EAAS,EAAAmB,YAAY,EAAAS,WAErBC,EAAUf,EAAMgB,SAAQ,KAC5B,MAAMC,EAAS,EAAAC,aAAazB,GAC5B,MAAO,CACL,eAAgBwB,EAAOE,WACvB,UAAWF,EAAOG,MAClB,eAAgBH,EAAOI,WACvB,WAAYJ,EAAOK,OACnB,iBAAkBL,EAAOM,aACzB,iBAAkBN,EAAOO,aACzB,iBAAkBP,EAAOQ,aACzB,eAAgBR,EAAOS,WACvB,UAAWT,EAAOU,MAClB,QAASV,EAAOW,IAChB,aAAcX,EAAOY,SACrB,eAAgBZ,EAAOa,cAExB,CAACrC,KAEGsC,EAAaC,GAAkBhC,EAAMiC,UAAS,GAE/CC,EAAqBlC,EAAMmC,aAAY,IAAMH,GAAe,IAAQ,IACpEI,EAAoBpC,EAAMmC,aAAY,IAAMH,GAAe,IAAO,IAClEK,EAAgBrC,EAAMmC,aAAY,IAAMvC,EAAS,EAAAb,cAAc,CAACa,IA2BtE,OAzBAI,EAAMsC,WAAU,KACd,MAAMC,EAAmBC,IACN,IAAbA,EAAEC,SACND,EAAEE,iBACF9C,EAAS,EAAA+C,kBAELC,EAAiBJ,IACN,OAAXA,EAAEK,MAAejD,EAAS,EAAAb,aACf,WAAXyD,EAAEK,MAAmBb,GAAgBc,IAAUA,IACpC,SAAXN,EAAEK,MAAmBL,EAAEO,UACrBP,EAAEQ,SACJpD,EAAS,EAAAqD,QAETrD,EAAS,EAAAsD,UAMf,OAFAC,SAASC,iBAAiB,YAAab,GACvCY,SAASC,iBAAiB,UAAWR,GAC9B,KACLO,SAASE,oBAAoB,YAAad,GAC1CY,SAASE,oBAAoB,UAAWT,MAEzC,CAAChD,IAGF,uBAAK0D,MAAOvC,GACV,gBAAC,UAAkB,MAClBgB,GACC,gCACE,gBAAC,UAAO,CAACwB,QAASrB,EAAoBsB,UAAW,EAAAC,eACjD,uBAAKC,QAASxB,EAAoBsB,UAAW,EAAAG,eAGjD,uBAAKH,UAAW,EAAAI,QACd,2BACE,0BAAQC,MAAM,WAAWC,SAAU,EAAGJ,QAASrB,EAAemB,UAAW,EAAAf,QACvE,sCAAkB,QAAM,OACxB,wBAAMa,MAAO,CAAES,QAAS,SAAQ,aAElC,wBAAMF,MAAM,cAAcL,UAAW,EAAAQ,OAClCC,OAAO/E,GAAQgF,SAAS,EAAG,OAGhC,2BACE,wBAAML,MAAM,QAAQL,UAAW,EAAAQ,OAC5BpD,GAEH,0BAAQiD,MAAM,YAAYC,SAAU,EAAGJ,QAAStB,EAAmBoB,UAAW,EAAAf,QAC5E,sCAAkB,QAAM,MACxB,wBAAMa,MAAO,CAAES,QAAS,SAAQ,gBAItC,gBAAC,UAAU,CAACP,UAAW,EAAAW,MACpB/D,EAAOgE,KAAKC,GACX,gBAAC,UAAY,eACXC,IAAK,GAAGD,EAAMhF,QAAQgF,EAAME,QAC5BF,MAAOA,GACFA,EAAMhF,OAAS,EAAAmF,UAAUC,OAAS,CAAEhE,WACpC4D,EAAMhF,OAAS,EAAAmF,UAAUE,OAAS,CAAEnE,wB,4EC9GrD,eACA,SACA,SACA,SACA,OAkCA,UAAeP,EAAMC,MAhCO,KAC1B,MAAM0E,EAAM3E,EAAM4E,OAAuB,MACnCC,EAAe7E,EAAM4E,SACrBE,EAAS,EAAAzE,YAAY,EAAA0E,YACrBhB,EAAUe,EAAS,GAAK,OAyB9B,OAvBA9E,EAAMsC,WAAU,KACd,GAAmB,MAAfqC,EAAIK,QAAiB,OACzBH,EAAaG,QAAU,IAAIC,EAAgBN,EAAIK,SAQ/C,OAFA7B,SAASC,iBAAiB,WAJK8B,I,MACd,WAAXA,EAAGZ,MAAsC,QAApB,EAAAO,EAAaG,eAAO,SAAEG,WAK1C,K,MACe,QAApB,EAAAN,EAAaG,eAAO,SAAEI,aAEvB,CAACT,EAAKG,IAET9E,EAAMsC,WAAU,K,QACVwC,EACkB,QAApB,EAAAD,EAAaG,eAAO,SAAEK,QAEF,QAApB,EAAAR,EAAaG,eAAO,SAAEG,SAEvB,CAACL,IAEG,uBAAKtB,UAAW,EAAA8B,UAAWhC,MAAO,CAAES,UAASwB,OAAQ,GAAKZ,IAAKA,Q,mdCnCxE,eAEA,SACA,SACA,SACA,SACA,SAQa,EAAAa,QAAUxF,EAAMyF,cAAkC,MAE/D,MAAMC,EAAY,CAACC,EAA0CC,KAC3D,MAAQC,YAAarD,GAAMmD,EACrBG,EAAStD,EAAEuD,OACXC,EAAQ,CAAEC,EAAGzD,EAAE0D,QAASC,EAAG3D,EAAE4D,SAC7BC,EAAMP,EAAOQ,WAAW,MAC9B,IAAK,MAAMC,KAAQX,EAAUY,OAC3B,GAAIH,aAAG,EAAHA,EAAKI,cAAcF,EAAMP,EAAMC,EAAGD,EAAMG,GAAI,CAC9C,MAAMO,EAAQd,EAAUe,IAAIJ,GAC5B,GAAa,MAATG,EAAe,OACnB,MAAO,CAAEA,QAAOV,WAIhBY,EAAiE,I,IAAA,SAAEC,GAAQ,EAAKC,EAAI,IAAnB,cACrE,MAAMlB,EAAY5F,EAAM4E,OAA8B,IAAImC,KACpDC,EAAgBhH,EAAM4E,OAA6B,IAAImC,KACvDE,EAAsBjH,EAAM4E,OAA6B,IAAImC,MAE7D,IAAEV,EAAG,MAAEa,EAAK,OAAEC,EAAM,gBAAEC,GAAoB,EAAAC,gBAC1CC,EAAkB,EAAAjH,YAAY,EAAAM,UAC9B4G,EAAc,EAAArG,aAAaoG,GAE3BE,EAAUxH,EAAMgB,SAA+B,IAC9CkG,GAAUC,GAAWd,EACnB,CAAEA,MAAKa,QAAOC,SAAQG,kBAAiBC,eADR,MAErC,CAAClB,EAAKa,EAAOC,EAAQG,EAAiBC,IAEzCvH,EAAMyH,iBAAgB,IAAOD,GAAW,EAAAE,WAAWF,SAAa,GAAQ,CAACA,IAEzE,MAAMG,EAAQ3H,EAAMgB,SAClB,IACEwG,GAAW,CACTA,UACA,IAAId,EAAOkB,GACThC,EAAUZ,QAAQ6C,IAAInB,EAAMH,KAAMG,GAC9BkB,EAAOlE,SAASsD,EAAchC,QAAQ6C,IAAInB,EAAMH,KAAMqB,EAAOlE,SAC7DkE,EAAOE,eAAeb,EAAoBjC,QAAQ6C,IAAInB,EAAMH,KAAMqB,EAAOE,gBAE/E,OAAOvB,GACLX,EAAUZ,QAAQ+C,OAAOxB,GACzBS,EAAchC,QAAQ+C,OAAOxB,GAC7BU,EAAoBjC,QAAQ+C,OAAOxB,MAGzC,CAACiB,IAGGQ,EAA0BhI,EAAMmC,aAAawD,IACjD,MAAMsC,EAAYvC,EAAUC,EAAKC,EAAUZ,SAC3C,GAAIiD,EAAW,CACb,MAAM,MAAEvB,EAAK,MAAEV,GAAUiC,EACnBC,EAAQjB,EAAoBjC,QAAQ2B,IAAID,EAAMH,MAChD2B,GAAOA,EAAMxB,EAAOV,MAEzB,IAEGmC,EAAoBnI,EAAMmC,aAAawD,IAC3C,MAAMsC,EAAYvC,EAAUC,EAAKC,EAAUZ,SAC3C,GAAIiD,EAAW,CACb,MAAM,MAAEvB,EAAK,MAAEV,GAAUiC,EACnBC,EAAQlB,EAAchC,QAAQ2B,IAAID,EAAMH,MAC1C2B,GAAOA,EAAMxB,EAAOV,MAEzB,IAEH,OACE,gCACE,wCACEoC,GAAG,SACHzD,IAAKyC,EACLF,MAAOmB,OAAOC,WACdnB,OAAQkB,OAAOE,YACf7E,QAASyE,EACTL,cAAeE,GACXlB,IAEN,gBAAC,EAAAtB,QAAQ1F,SAAQ,CAAC6H,MAAOA,GAAQd,KAK9B,EAAAD,aACT,UAAe5G,EAAMC,KAAK2G,I,kdClG1B,eACA,SACA,OACA,SACA,SACA,SACA,SAEM4B,EAAmC,IAAIC,IAChC,EAAAC,UAAY1I,EAAMyF,cAAc+C,GAa7C,MAAMG,EAA+B3I,EAAMC,MACxC,I,IAAA,MAAE0H,EAAK,SAAEiB,EAAQ,KAAEC,EAAI,QAAEC,EAAU,GAAE,MAAE9E,EAAK,IAAE+E,EAAG,IAAEC,EAAG,KAAE3J,EAAO,QAAM,EAAK4J,EAAK,IAA/E,kEACC,MAAOC,EAAUC,GAAYnJ,EAAMiC,SAAS0F,GAEtCyB,EAAepJ,EAAMmC,aAAaK,GAA2C2G,EAAS3G,EAAEuD,OAAO4B,QAAQ,IAEvG0B,EAAerJ,EAAMmC,aAAY,KACjC+G,IAAavB,GAAOiB,EAASM,KAChC,CAACvB,EAAOuB,EAAUN,IASrB,OAPA5I,EAAMsC,WAAU,KACdkG,EAAgBc,IAAID,GACb,KACLb,EAAgBT,OAAOsB,OAKzB,4CAAcJ,GACZ,8BAASjF,GACW,IAAnB8E,EAAQS,OACP,2BACE,yBAAOC,QAAS,UAAUX,IAAQvF,MAAO,CAAES,QAAS,SACjDC,GAEH,uCACE3E,KAAMA,EACN+I,GAAI,UAAUS,IACdlB,MAAO1D,OAAOiF,GACdN,SAAUQ,GACLL,GAAO,CAAEA,OACTC,GAAO,CAAEA,UAIlBF,EAAQ1E,KAAI,EAAEJ,EAAOyF,KACnB,uBAAKnF,IAAKN,EAAM0F,YACd,yBACErK,KAAK,QACL+I,GAAI,GAAGS,KAAQ7E,IACf2F,QAAST,IAAaO,EACtB9B,MAAO1D,OAAOwF,GACdb,SAAUQ,IAEZ,yBAAOI,QAAS,GAAGX,KAAQ7E,KAAUA,UASnD2E,EAAOiB,YAAc,SAErB,MAAMC,EAAuC,CAC3C,CAAC,UAAW,EAAAvK,YAAYC,SACxB,CAAC,QAAS,EAAAD,YAAYwK,QAGlBC,EAAkD,CACtD,CAAC,OAAQ,EAAArK,gBAAgBC,MACzB,CAAC,QAAS,EAAAD,gBAAgBsK,QAKtBC,EAA0CjK,EAAMC,MAAM,I,IAAA,QAAEsD,GAAO,EAAK0F,EAAK,IAAnB,aAC1D,MAAMI,EAAerJ,EAAMmC,aACxBK,IACCA,EAAEE,iBACF8F,EAAgB0B,SAASC,GAAOA,MAChC5G,MAEF,CAACA,IAGG3D,EAAW,EAAAO,cACXd,EAAO,EAAAgB,YAAY,EAAA+J,SACnB3K,EAAQ,EAAAY,YAAY,EAAAM,UACpB0J,EAAa,EAAAhK,YAAY,EAAAS,WAEzBwJ,EAAkBtK,EAAMmC,aAAajD,GAAWU,EAAS,EAAAb,UAAUwL,SAASrL,EAAQ,OAAO,CAACU,IAC5F4K,EAAgBxK,EAAMmC,aAAa9C,GAASO,EAAS,EAAAR,QAAQC,KAAQ,CAACO,IACtE6K,EAAiBzK,EAAMmC,aAAa1C,GAAUG,EAAS,EAAA8K,YAAYjL,KAAS,CAACG,IAEnF,OACE,sCAAM+K,SAAUtB,GAAkBJ,GAChC,gBAACN,EAAM,CACLE,KAAK,cACL7E,MAAM,cACN3E,KAAK,SACL0J,IAAK,EACLC,IAAK,KACLrB,MAAO0C,EACPzB,SAAU0B,IAEZ,gBAAC3B,EAAM,CAACE,KAAK,OAAO7E,MAAM,YAAY2D,MAAOtI,EAAMuJ,SAAU4B,EAAe1B,QAASe,IACrF,gBAAClB,EAAM,CAACE,KAAK,QAAQ7E,MAAM,QAAQ2D,MAAOlI,EAAOmJ,SAAU6B,EAAgB3B,QAASiB,IACpF,0BAAQ1K,KAAK,UAAQ,YAOlB,EAAA4K,UAFTA,EAAQL,YAAc,kBAGtB,UAAe5J,EAAMC,KAAKgK,I,kGCjI1B,eACA,SACA,SACA,SACA,SACA,SAEA,SACA,SAEMW,EAID,EAAGvG,QAAO9D,aAAY,EAAOE,UAAUoK,QAC1C,MAAMjL,EAAW,EAAAO,cACX2K,EAAc9K,EAAM+K,WAAW,EAAAvF,SAE/BwF,EAAc,EAAAhK,SAClB,IAAM8J,GAAe,EAAAG,uBAAuBH,EAAYtD,QAASnD,EAAO,CAAE9D,YAAWE,aACrF,CAACqK,EAAazG,EAAO9D,EAAWE,IAG5BqH,EAAgB9H,EAAMmC,aAC1B,CAACuE,EAAiBV,KAChB,GAAmB,MAAf8E,GAAsC,MAAfE,EAAqB,OAChD,MAAME,EAAO7G,EAAM8G,YAAc,EAAAC,eAAeC,WAAa,IAAM,IAC7DC,EAAQjH,EAAMiH,MAAMC,OAAOP,EAAYhC,KACvCzE,EAAQiH,KAAKzC,IAAIuC,EAAM/B,OAAS,EAAGiC,KAAKC,OAAOzF,EAAMkF,GAAQF,EAAYU,IAAIR,IAASF,EAAYW,QACpGtH,EAAMhF,OAAS,EAAAmF,UAAUC,OAASF,IAAU+G,EAAM/B,OAAS,GAC7D3J,EAAS,EAAAgM,gBAAgB,CAAEvH,QAAOwH,UAAWP,EAAM/G,QAEvD,CAAC3E,EAAUkL,EAAaE,EAAa3G,IAGjCX,EAAU1D,EAAMmC,aACpB,CAACuE,EAAiBV,KAChB,GAAmB,MAAf8E,GAAsC,MAAfE,EAAqB,OAChD,MAAME,EAAO7G,EAAM8G,YAAc,EAAAC,eAAeC,WAAa,IAAM,IAC7DC,EAAQjH,EAAMiH,MAAMC,OAAOP,EAAYhC,KACvCzE,EAAQiH,KAAKzC,IAAIuC,EAAM/B,OAAS,EAAGiC,KAAKC,OAAOzF,EAAMkF,GAAQF,EAAYU,IAAIR,IAASF,EAAYW,QACpGtH,EAAMhF,OAAS,EAAAmF,UAAUC,OAASF,IAAU+G,EAAM/B,OAAS,GAC7D3J,EAAS,EAAAkM,UAAU,CAAEzH,QAAOwH,UAAWP,EAAM/G,QAEjD,CAAC3E,EAAUkL,EAAaE,EAAa3G,IAKvC,OAFA,EAAA0H,YAAYvE,GAAY,EAAAwE,UAAUxE,EAASwD,IAAc,CAAEtH,UAASoE,kBAE7D,MAGA,EAAA8C,eACT,UAAe5K,EAAMC,KAAK2K,I,mMCrD1B,eAEA,SACA,SAEA,SAiCA,IAAKqB,EArBQ,EAAAC,WAAa,EAAGjG,IAAGE,IAAGe,QAAOC,UAAegF,EAAS,GAAIC,EAAU,KAC9E,MAAM7F,EAAO,IAAI8F,OAEXC,EAAKrG,EAAImG,EACTG,EAAKpG,EAAIiG,EACTI,EAAKtF,EAAkB,EAAVkF,EACbK,EAAKtF,EAAmB,EAAViF,EAYpB,OAVA7F,EAAKmG,OAAOJ,EAAKH,EAAQI,GACzBhG,EAAKoG,OAAOL,EAAKE,EAAKL,EAAQI,GAC9BhG,EAAKqG,iBAAiBN,EAAKE,EAAID,EAAID,EAAKE,EAAID,EAAKJ,GACjD5F,EAAKoG,OAAOL,EAAKE,EAAID,EAAKE,EAAKN,GAC/B5F,EAAKqG,iBAAiBN,EAAKE,EAAID,EAAKE,EAAIH,EAAKE,EAAKL,EAAQI,EAAKE,GAC/DlG,EAAKoG,OAAOL,EAAKH,EAAQI,EAAKE,GAC9BlG,EAAKqG,iBAAiBN,EAAIC,EAAKE,EAAIH,EAAIC,EAAKE,EAAKN,GACjD5F,EAAKoG,OAAOL,EAAIC,EAAKJ,GACrB5F,EAAKqG,iBAAiBN,EAAIC,EAAID,EAAKH,EAAQI,GAC3ChG,EAAKsG,YACEtG,GAGT,SAAK0F,GACH,yBACA,uBAFF,CAAKA,MAAY,KAKJ,EAAAa,kBAAoB,CAACtF,GAA2BuF,OAAMC,aACjE,GAAIA,EAAQ,MAAO,GAEnB,MAAM,IAAE3G,GAAQmB,GACRN,MAAO+F,EAAW9F,OAAQ+F,GAAe,EAAAC,kBAAkB3F,GAC7D4F,EAAe,EAAAC,sBAAsB7F,GACrC8F,EAAc,EAAAC,wBAAwB/F,GAEtCgG,EAAchC,KAAKC,MAAkB,GAAZwB,GACzBQ,EAAqBpO,GACzB,EAAAqO,OACErH,GACA,CAACa,EAAeC,IACd9H,IAAS4M,EAAa0B,OAClBzG,EAAQsG,EACR,EAAAI,MAAMb,GACN7F,EAAQ+F,EAAwC,EAA5BzB,KAAKC,MAAMwB,EAAY,GAC3C/F,EAAQsE,KAAKC,MAAMwB,EAAY,IAAM9F,EAASqE,KAAKC,MAAMyB,EAAa,KAC5E7N,IAAS4M,EAAa0B,OAAS,KAAO,KAGpCE,EAA+C,CACnD,CAAC5B,EAAa0B,QAASF,EAAkBxB,EAAa0B,QACtD,CAAC1B,EAAa6B,SAAUL,EAAkBxB,EAAa6B,UAOnDC,EAAeT,EAAc,EAC7BU,EAAeZ,EAAe,EAC9Ba,EAAcX,EAAc,EAC5BY,EAAcZ,EAAc,EALb,EAAAa,cAAc9H,EAAKwH,EAAU5B,EAAa0B,UAOzD,KAAES,EAAI,MAAEzG,GAAUoF,EAGlBsB,EAAY,CAChB,CAAEpI,EAAG8H,EAAc5H,EAAG6H,EAAcM,MAAO3G,GAC3C,CAAE1B,EAAGgI,EAAa9H,EAAG+H,EAAaI,MAAOF,IACzCG,QAAgB,CAACtO,EAAMqO,KACvBrO,EAAKuO,KAAK,OAAD,wBAEFF,GAAK,CACRG,SAAS,EACTC,UAAW,OACXC,aAAc,MACdC,KAAMf,EAAU5B,EAAa0B,UAAO,+BAGjCW,GAAK,CACRG,SAAS,EACTC,UAAW,OACXC,aAAc,MACdC,KAAMf,EAAU5B,EAAa0B,WAG1B1N,IACN,IAMG4O,EAA8B,GAGlC,CACE,EAAAC,UAAUC,IACV,EAAAD,UAAUE,MACV,EAAAF,UAAUG,KACV,EAAAH,UAAUI,KACV,EAAAJ,UAAUK,KACV,EAAAL,UAAUM,MACV,EAAAN,UAAUO,MACVC,SAAS3H,IAEXkH,EAAIL,KAAK,CAAEvI,EAAG,EAAGE,EAAG,IAGlB,CAAC,EAAA2I,UAAUS,IAAK,EAAAT,UAAUE,OAAOM,SAAS3H,IAC5CkH,EAAIL,KAAK,CAAEvI,EAAG,EAAGE,EAAG,GAAK,CAAEF,EAAG,EAAGE,EAAG,IAIpC,CACE,EAAA2I,UAAUU,KACV,EAAAV,UAAUG,KACV,EAAAH,UAAUW,IACV,EAAAX,UAAUY,MACV,EAAAZ,UAAUa,MACV,EAAAb,UAAUI,KACV,EAAAJ,UAAUc,KACVN,SAAS3H,IAEXkH,EAAIL,KAAK,CAAEvI,EAAG,EAAGE,EAAG,GAAK,CAAEF,EAAG,EAAGE,EAAG,GAAK,CAAEF,EAAG,EAAGE,EAAG,GAAK,CAAEF,EAAG,EAAGE,EAAG,IAGlE,CAAC,EAAA2I,UAAUW,IAAK,EAAAX,UAAUY,MAAO,EAAAZ,UAAUa,OAAOL,SAAS3H,IAC7DkH,EAAIL,KAAK,CAAEvI,EAAG,EAAGE,EAAG,GAAK,CAAEF,EAAG,EAAGE,EAAG,IAGlC,CAAC,EAAA2I,UAAUY,MAAO,EAAAZ,UAAUc,IAAK,EAAAd,UAAUa,OAAOL,SAAS3H,IAC7DkH,EAAIL,KAAK,CAAEvI,EAAG,EAAGE,EAAG,IAGlB,CAAC,EAAA2I,UAAUI,KAAM,EAAAJ,UAAUc,KAAKN,SAAS3H,IAC3CkH,EAAIL,KAAK,CAAEvI,EAAG,EAAGE,EAAG,GAAK,CAAEF,EAAG,EAAGE,EAAG,GAAK,CAAEF,EAAG,EAAGE,EAAG,GAAK,CAAEF,EAAG,EAAGE,EAAG,IAGlE,CAAC,EAAA2I,UAAUc,IAAK,EAAAd,UAAUa,OAAOL,SAAS3H,IAC5CkH,EAAIL,KAAK,CAAEvI,EAAG,EAAGE,EAAG,IAGtB,MAAM0J,EAAU1J,IACd,OAAQA,GACN,KAAK,EACL,KAAK,EACH,MAAoB,GAAb+G,EACT,KAAK,EACL,KAAK,EACH,MAAoB,GAAbA,EACT,KAAK,EACL,KAAK,EACH,MAAoB,GAAbA,EACT,KAAK,EACH,MAAoB,GAAbA,IAIP4C,EAAW7J,IACf,OAAQA,GACN,KAAK,EACH,MAAmB,IAAZgH,EACT,KAAK,EACH,MAAmB,GAAZA,EACT,KAAK,EACH,MAAmB,IAAZA,IAIP8C,EAAgB9J,IACpB,OAAQA,GACN,KAAK,EACH,MAAO,OACT,KAAK,EACH,MAAO,SACT,KAAK,EACH,MAAO,UAgBb,OAZA4I,EAAI3E,SAAQ,EAAGjE,IAAGE,QAChBkI,EAAUG,KAAK,CACbvI,EAAG6J,EAAQ7J,GACXE,EAAG0J,EAAO1J,GACVmI,MAAOF,EACPM,UAAWqB,EAAa9J,GACxB0I,aAAc,SACdF,QAAStI,EAAI,EACbyI,KAAMf,EAAU5B,EAAa6B,cAI1BO,GAGI,EAAA2B,kBAAqBxI,IAChC,MAAM,IAAEnB,EAAG,YAAEkB,GAAgBC,GACvB,MAAEN,EAAK,OAAEC,GAAW,EAAAgG,kBAAkB3F,GACtCkE,EAAM,CAAEzF,EAAG,EAAGE,EAAG,EAAGe,QAAOC,UAOjC,OANAd,EAAI4J,UAAU,EAAG,EAAG/I,EAAOC,GAC3Bd,EAAI6J,UAAY3I,EAAYlG,WAC5BgF,EAAI8J,SAASzE,EAAIzF,EAAGyF,EAAIvF,EAAGuF,EAAIxE,MAAOwE,EAAIvE,QAC1Cd,EAAI+J,UAAY,GAChB/J,EAAIgK,YAAc9I,EAAY7F,WAC9B2E,EAAIiK,WAAW5E,EAAIzF,EAAGyF,EAAIvF,EAAGuF,EAAIxE,MAAOwE,EAAIvE,QACrCd,EAAIkK,aAAa7E,EAAIzF,EAAGyF,EAAIvF,EAAGuF,EAAIxE,MAAOwE,EAAIvE,SAG1C,EAAAqJ,mBAAsBhJ,IACjC,MAAM,IAAEnB,EAAG,YAAEkB,GAAgBC,GACvB,MAAEN,EAAK,OAAEC,GAAW,EAAAgG,kBAAkB3F,GACtCkE,EAAM,CAAEzF,EAAG,EAAGE,EAAG,EAAGe,QAAOC,UAE3BsJ,EAAOtN,SAASuN,cAAc,UAEpCD,EAAKvJ,MAAQuJ,EAAKtJ,OADA,GAElB,MAAMwJ,EAAUF,EAAKnK,WAAW,MAC1BsK,EAAWD,EAAQE,qBAAqB,EAAG,EAAGJ,EAAKvJ,MAAOuJ,EAAKtJ,QA2BrE,OAzBAyJ,EAASE,aAAa,EAAGvJ,EAAYhG,cACrCqP,EAASE,aAAa,IAAMvJ,EAAYhG,cAExCqP,EAASE,aAAa,IAAMvJ,EAAY/F,cACxCoP,EAASE,aAAa,GAAKvJ,EAAY/F,cAEvCoP,EAASE,aAAa,GAAKvJ,EAAYhG,cACvCqP,EAASE,aAAa,IAAMvJ,EAAYhG,cAExCqP,EAASE,aAAa,IAAMvJ,EAAY/F,cACxCoP,EAASE,aAAa,EAAGvJ,EAAY/F,cAErCmP,EAAQT,UAAYU,EACpBD,EAAQR,SAAS,EAAG,EAlBF,OAoBlB9J,EAAI4J,UAAUvE,EAAIzF,EAAGyF,EAAIvF,EAAGuF,EAAIxE,MAAOwE,EAAIvE,QAC3Cd,EAAIgK,YAAc9I,EAAY7F,WAC9B2E,EAAI+J,UAAY,EAChB/J,EAAI0K,OAAO,EAAA7E,WAAWR,IACtBrF,EAAI2K,OACJ3K,EAAI4K,KAAK,EAAA/E,WAAWR,EAAK,KACzBrF,EAAI6J,UAAY7J,EAAI6K,cAAcT,EAAM,UACxCpK,EAAI8J,SAASzE,EAAIzF,EAAI,EAAGyF,EAAIvF,EAAI,EAAGuF,EAAIxE,MAAQ,EAAGwE,EAAIvE,OAAS,GAC/Dd,EAAI8K,UAEG9K,EAAIkK,aAAa7E,EAAIzF,EAAGyF,EAAIvF,EAAGuF,EAAIxE,MAAOwE,EAAIvE,SAG1C,EAAAiK,iBAAmB,CAAC5J,EAAyBuF,KACxD,MAAM,IAAE1G,EAAG,YAAEkB,GAAgBC,GACvB,MAAEN,EAAK,OAAEC,GAAW,EAAAgG,kBAAkB3F,GACtCkE,EAAM,CAAEzF,EAAG,EAAGE,EAAG,EAAGe,QAAOC,UAEjCd,EAAI4J,UAAUvE,EAAIzF,EAAGyF,EAAIvF,EAAGuF,EAAIxE,MAAOwE,EAAIvE,QAC3Cd,EAAIgK,YAAc9I,EAAY7F,WAC9B2E,EAAI+J,UAAY,EAChB/J,EAAI0K,OAAO,EAAA7E,WAAWR,EAAK,KAE3BrF,EAAI6J,UAAYnD,EAAKlL,SAAW0F,EAAY1F,SAAW0F,EAAYjG,OACnE+E,EAAIgL,KAAK,EAAAnF,WAAWR,EAAK,GAAI,KAE7B,IAAK,MAAM4C,KAAS,EAAAxB,kBAAkBtF,EAASuF,GAC7C1G,EAAI6J,UAAY,EAAAoB,MAAMvE,EAAKA,MAAQxF,EAAY3F,IAAM2F,EAAY5F,MACjE0E,EAAIqI,UAAYJ,EAAMI,UACtBrI,EAAIsI,aAAeL,EAAMK,aACzBtI,EAAIuI,KAAON,EAAMM,KACbN,EAAMG,UACRpI,EAAI2K,OACJ3K,EAAIkL,UAAUrK,EAAOC,GACrBd,EAAImL,OAAOhG,KAAKiG,KAElBpL,EAAIqL,SAASpD,EAAMA,MAAOA,EAAMrI,EAAIyF,EAAIzF,GAAKqI,EAAMG,SAAW,EAAI,GAAIH,EAAMnI,EAAIuF,EAAIvF,GAAKmI,EAAMG,SAAW,EAAI,IAC1GH,EAAMG,SAASpI,EAAI8K,UAEzB,OAAO9K,EAAIkK,aAAa7E,EAAIzF,EAAGyF,EAAIvF,EAAGuF,EAAIxE,MAAOwE,EAAIvE,SAG1C,EAAAwK,kBAAqBnK,IAChC,MAAM,IAAEnB,EAAG,YAAEkB,GAAgBC,GACvB,MAAEN,EAAK,OAAEC,GAAW,EAAAgG,kBAAkB3F,GACtCkE,EAAM,CAAEzF,EAAG,EAAGE,EAAG,EAAGe,QAAOC,UASjC,OARAd,EAAI4J,UAAUvE,EAAIzF,EAAGyF,EAAIvF,EAAGuF,EAAIxE,MAAOwE,EAAIvE,QAC3Cd,EAAI6J,UAAY3I,EAAYlG,WAC5BgF,EAAIgL,KAAK,EAAAnF,WAAWR,IACpBrF,EAAIuI,KAAO,kBACXvI,EAAIqI,UAAY,SAChBrI,EAAIsI,aAAe,SACnBtI,EAAI6J,UAAY3I,EAAYzF,WAC5BuE,EAAIqL,SAAS,IAAKhG,EAAIxE,MAAQ,EAAGwE,EAAIvE,OAAS,GACvCd,EAAIkK,aAAa7E,EAAIzF,EAAGyF,EAAIvF,EAAGuF,EAAIxE,MAAOwE,EAAIvE,U,yBC9RvD,IAAYzH,E,yFAAZ,SAAYA,GACV,cACA,gBAFF,CAAYA,EAAA,EAAAA,kBAAA,EAAAA,gBAAe,KAoBd,EAAAwB,aAA0D,CACrE,CAACxB,EAAgBC,MAAO,CACtBwB,WAAY,OACZC,MAAO,OACPC,WAAY,UACZC,OAAQ,OACRC,aAAc,UACdC,aAAc,UACdC,aAAc,OACdC,WAAY,OACZC,MAAO,UACPC,IAAK,UACLC,SAAU,UACVC,WAAY,QAEd,CAACpC,EAAgBsK,OAAQ,CACvB7I,WAAY,UACZC,MAAO,OACPC,WAAY,UACZC,OAAQ,OACRC,aAAc,UACdC,aAAc,UACdC,aAAc,OACdC,WAAY,OACZC,MAAO,UACPC,IAAK,UACLC,SAAU,UACVC,WAAY,S,yICjEhB,eAEA,QACA,SA6CA,IAAI8P,EALS,EAAAC,OAAS,EAAG9E,MAAQqB,OAAMzG,SAAS9F,cAC9C,GAAGuM,KAAQzG,MAAU9F,IAAY,GAAO6H,aAE7B,EAAAoI,UAAoC,IAAI/K,IAIxC,EAAAW,WAAcF,IACzB,MAAM,MAAEN,EAAK,OAAEC,GAAW,EAAAgG,kBAAkB3F,GAC5C,EAAAsK,UAAUjK,IAAI,SAAU,EAAA2I,mBAAmBhJ,IAC3C,EAAAsK,UAAUjK,IAAI,QAAS,EAAAmI,kBAAkBxI,IACzC,EAAAsK,UAAUjK,IAAI,QAAS,EAAA8J,kBAAkBnK,IACzC,EAAAuK,MAAM7H,SAAS6C,IACb,EAAA+E,UACGjK,IAAI,EAAAgK,OAAO,CAAE9E,OAAMlL,UAAU,IAAS,EAAAuP,iBAAiB5J,EAAS,CAAEuF,OAAMlL,UAAU,KAClFgG,IAAI,EAAAgK,OAAO,CAAE9E,OAAMlL,UAAU,IAAU,EAAAuP,iBAAiB5J,EAAS,CAAEuF,OAAMlL,UAAU,QAGxF+P,EAAKzO,SAASuN,cAAc,UAC5BkB,EAAG1K,MAAQA,EACX0K,EAAGzK,OAASA,EACZK,EAAQnB,IAAI4J,UAAU,EAAG,EAAG/I,EAAQ,EAAGC,EAAS,IAKrC,EAAA6K,kBAAoB,CAACxK,EAAyByK,EAAiBhM,EAAWE,KACrF,MAAM+L,EAAON,EAAGtL,WAAW,MAC3B4L,WAAMC,aAAaF,EAAM,EAAG,GAC5BzK,EAAQnB,IAAI+L,UAAUR,EAAI3L,EAAGE,K,yHCxE/B,MAAMkM,EAAeC,MAAMC,KAAqB,CAAEhJ,OAAQ,MAAO,CAACiJ,EAAGC,IAAMA,IAM9D,EAAAC,aAAe,CAACrM,EAA+BuI,EAAc+D,KACxEtM,EAAIuI,KAAOA,EACJvI,EAAIuM,YAAYD,GAAMzL,OAGlB,EAAAiH,cAAgB,CAAC9H,EAA+BuI,KAC3DvI,EAAIuI,KAAOA,EACJvI,EAAIuM,YAAY,KAAK1L,OAG9B,MAAM2L,EAAiB,CACrBxM,EACAyM,EACAH,EACA5J,EACAC,KAEA,MAAMzE,EAAQiH,KAAKC,OAAOzC,EAAMD,GAAO,GACjC6F,EAAO,GAAGyD,EAAa9N,kBACvB2C,EAAQ,EAAAwL,aAAarM,EAAKuI,EAAM+D,GAChCxL,EAAS,EAAAgH,cAAc9H,EAAKuI,GAClC,OAAI7F,EAAMC,EAAY4F,EAClBkE,EAAY5L,EAAOC,GAAgB0L,EAAexM,EAAKyM,EAAaH,EAAM5J,EAAKxE,EAAQ,GACpFsO,EAAexM,EAAKyM,EAAaH,EAAMpO,EAAQ,EAAGyE,IAG9C,EAAA0E,OAAS,CAACrH,EAA+ByM,EAA0BH,IAC9EE,EAAexM,EAAKyM,EAAaH,EAAM,EAAGN,EAAa9I,OAAS,I,2OChClE,eAEa,EAAAwJ,wBAA2B1M,GAAwBmF,KAAKC,MAAmB,IAAbpF,EAAIc,QAElE,EAAA6L,yBAA4B3M,GAAwBmF,KAAKC,MAAmB,IAAbpF,EAAIc,QAEnE,EAAAkG,sBAAyBhH,GAAwBmF,KAAKC,MAAmB,IAAbpF,EAAIc,QAEhE,EAAAoG,wBAA2BlH,GAAwBmF,KAAKC,MAAkB,IAAZpF,EAAIa,OAElE,EAAA+L,aAAe,KAAW,CAAGhN,EAAG,EAAGE,EAAG,EAAGe,MAAO,EAAGC,OAAQ,KAQ3D,EAAAgG,kBAAqB9G,IAChC,MAAM6M,EAAmB,EAAA3F,wBAAwBlH,GAC3C8M,EAAiB,EAAA9F,sBAAsBhH,GACvC+M,EAAY,EAAAH,eACZI,EAAwB,EAAAL,yBAAyB3M,GAEjDiN,EAAoBF,EAAUjM,OAA0B,EAAjBgM,EAA6C,GAAxBE,EAC5DE,EAAyC,EAAnBL,EAEtBM,EAAWhI,KAAKC,OAAOpF,EAAIa,MAAQqM,GAAuB,GAC1DE,EAAYjI,KAAKC,OAAOpF,EAAIc,OAASmM,GAAqB,KAE1DI,EAAgB,MAChBxM,EAAQsM,EAAWE,EAAgBD,EAAYD,EAAWC,EAAYC,EACtEvM,EAASqM,EAAWE,EAAgBD,EAAYD,EAAWE,EAAgBD,EAEjF,MAAO,CACLvM,MAAOsE,KAAKC,MAAMvE,GAClBC,OAAQqE,KAAKC,MAAMtE,KAIV,EAAAwM,YAAc,CAACtN,EAAqBhC,EAAc2E,KAC7D,MAAMmK,EAAiB,EAAA9F,sBAAsBhH,GACvC6M,EAAmB,EAAA3F,wBAAwBlH,GAC3CzC,EAAS,EAAAqP,gBACT,MAAE/L,EAAK,OAAEC,GAAW,EAAAgG,kBAAkB9G,GACtCuN,EAAapI,KAAKzC,IAAI1E,EAAMiH,MAAM/B,OAAQP,GAM1C6K,EAA+B,EAAnBX,EAA+B,EAARhM,EACnC4M,EAAQD,EAAYxN,EAAIa,OAASb,EAAIa,MAAQ2M,GAAa,EAAI,EAE9DE,EACJ1P,EAAM8G,YAAc,EAAAC,eAAeC,WAChB,IAAfuI,EACEzM,EACA,EAAA4L,wBAAwB1M,IAAQuN,EAAa,GAAK1M,EACpDA,EAEA8M,EACJ3P,EAAM8G,YAAc,EAAAC,eAAe6I,SAChB,IAAfL,EACEzM,EACA,EAAA6L,yBAAyB3M,IAAQuN,EAAa,GAAKzM,EACrDA,EAEN,OAAQ9C,EAAMhF,MACZ,KAAK,EAAAmF,UAAUE,MACb,MAAO,CACLyB,EAAGvC,EAAOuD,OAASgM,EACnBlN,EAAG6N,EACH5M,MAAO6M,EACP5M,OAAQ6M,GAEZ,KAAK,EAAAxP,UAAUC,MACb,MAAO,CACL0B,EAAGvC,EAAOuD,OAASgM,EACnBlN,EAAG6N,EAAQZ,EAAmBhM,EAC9BA,MAAO6M,EACP5M,OAAQ6M,GAEZ,KAAK,EAAAxP,UAAU0P,WACb,MAAO,CACL/N,EAAGvC,EAAOuD,OAASgM,EACnBlN,EAAG6N,EAAQ,EAAIZ,EAAmB,EAAIhM,EAAQ7C,EAAME,OAAS2O,EAAmBhM,GAChFA,MAAO6M,EACP5M,OAAQ6M,GAEZ,KAAK,EAAAxP,UAAU2P,QACb,MAAO,CACLhO,EAAGvC,EAAOuD,OAA0B,EAAjBgM,EAAqBhM,EACxClB,EAAG6N,EAAQzP,EAAME,OAAS2O,EAAmBhM,GAC7CA,MAAO6M,EACP5M,OAAQ6M,M,wHChGhB,eACA,SACA,SAca,EAAA/I,uBAAyB,CACpCzD,EACAnD,EACA+P,KAEA,MAAMpL,EACJ3E,EAAMhF,OAAS,EAAAmF,UAAUE,OAASL,EAAMhF,OAAS,EAAAmF,UAAU0P,WACvD,EACA7P,EAAMhF,OAAS,EAAAmF,UAAUC,MACzB2P,EAAK3T,SAAW,EAChB4D,EAAMiH,MAAM/B,OAEZmC,EAAM,EAAAiI,YAAYnM,EAASnD,EAAO2E,GAElC2C,EACJtH,EAAM8G,YAAc,EAAAC,eAAeC,WAAa,EAAA0H,wBAAwBvL,GAAW,EAAAwL,yBAAyBxL,GAE9G,MAAO,CACLnD,QACA9D,UAAW6T,EAAK7T,UAChBE,QAAS2T,EAAK3T,QACdkL,QACAD,MACA1C,QAIS,EAAAgD,UAAY,CAACxE,EAAyBwD,KACjD,GAAmB,MAAfA,EAAqB,OAAO,KAChC,MAAM,MAAE3G,EAAK,UAAE9D,EAAS,IAAEyI,EAAG,MAAE2C,EAAK,IAAED,GAAQV,EACxCM,EAAQjH,EAAMiH,MAAMC,OAAOvC,GAE3BzC,EAAO,IAAI8F,OACjB9F,EAAK8N,KAAK3I,EAAIzF,EAAGyF,EAAIvF,EAAGuF,EAAIxE,MAAOwE,EAAIvE,QACvCZ,EAAKsG,YAEL,MAAMyH,EAAyB,IAAjBhJ,EAAM/B,OACdgL,EAAQlQ,EAAMhF,OAAS,EAAAmF,UAAUE,OAAS4P,GAAS/T,EACnDiU,EAAW,GAEbD,EAAOC,EAAShG,KAAK,CAAEyD,KAAM,EAAAH,UAAUnL,IAAI,SAAUV,EAAGyF,EAAIzF,EAAGE,EAAGuF,EAAIvF,IACjEmO,EAAOE,EAAShG,KAAK,CAAEyD,KAAM,EAAAH,UAAUnL,IAAI,SAAUV,EAAGyF,EAAIzF,EAAGE,EAAGuF,EAAIvF,IAE7EmF,EAAMpB,SAAQ,CAAC6C,EAAM0H,KACnB,MAAMC,EAAU3H,EAAKC,OAAS,EAAA8E,UAAUnL,IAAI,UAAY,EAAAmL,UAAUnL,IAAI,EAAAkL,OAAO9E,IAC7E,GAAI2H,EAAS,CACX,MAAMzO,EAAI5B,EAAM8G,YAAc,EAAAC,eAAeC,WAAaoJ,EAAI9I,EAAQ,EAChExF,EAAI9B,EAAM8G,YAAc,EAAAC,eAAeC,WAAa,EAAIoJ,EAAI9I,EAClE6I,EAAShG,KAAK,CAAEyD,KAAMyC,EAASzO,EAAGyF,EAAIzF,EAAIA,EAAGE,EAAGuF,EAAIvF,EAAIA,QAI9D,IAAK,MAAM,KAAE8L,EAAI,EAAEhM,EAAC,EAAEE,KAAOqO,EAAUvC,GAAQ,EAAAD,kBAAkBxK,EAASyK,EAAMhM,EAAGE,GACnF,MAAO,CAAEI,OAAMmF,S,mGCrEjB,eAUa,EAAArE,cAAgB,KAC3B,MAAOvB,EAAQ6O,GAAa3U,EAAMiC,SAAmC,MAC/DmF,EAAkBpH,EAAMmC,aAAa2D,GAA8BA,GAAU6O,EAAU7O,IAAS,IAEhG8O,EAAU,KAAM,CAAG1N,MAAOmB,OAAOC,WAAYnB,OAAQkB,OAAOE,eAE3DsM,EAAMC,GAAW9U,EAAMiC,WAE9BjC,EAAMsC,WAAU,KACd,IAAIyS,EACJ,MAAMC,EAAa,KACbD,GAAKE,aAAaF,GACtBA,EAAM1M,OAAO6M,YAAW,IAAMJ,EAAQF,MAAY,MAGpD,OADAvM,OAAOjF,iBAAiB,SAAU4R,GAC3B,KACL3M,OAAOhF,oBAAoB,SAAU2R,OAezC,OAXehV,EAAMgB,SACnB,IAAO,OAAD,QACJoG,mBACItB,GAAU,OAAJ,QACRO,IAAKP,EAAOQ,WAAW,OACnBuO,UAAQD,OAGhB,CAACC,EAAMzN,EAAiBtB,M,gGCtC5B,eACA,SAOa,EAAAiG,WAAa,CAACoJ,EAAcvN,EAAoB,M,QAC3D,MAAMkD,EAAc9K,EAAM+K,WAAW,EAAAvF,SAC/B4P,EAAiBpV,EAAM4E,QAAO,GAC9ByQ,EAAYrV,EAAM4E,OAAiC,QAA1B,EAAAkG,aAAW,EAAXA,EAAatD,QAAQN,aAAK,QAAI,GACvDoO,EAAatV,EAAM4E,OAAkC,QAA3B,EAAAkG,aAAW,EAAXA,EAAatD,QAAQL,cAAM,QAAI,GAM/DnH,EAAMyH,iBAAgB,KACfqD,IACLsK,EAAepQ,WACZsQ,EAAWtQ,UAAY8F,EAAYtD,QAAQL,QAAUkO,EAAUrQ,UAAY8F,EAAYtD,QAAQN,QAChGoO,EAAWtQ,QAAU,GACrBqQ,EAAUrQ,QAAU,GAEtBsQ,EAAWtQ,QAAU8F,EAAYtD,QAAQL,OACzCkO,EAAUrQ,QAAU8F,EAAYtD,QAAQN,SACvC,CAAC4D,IAEJ9K,EAAMsC,WAAU,KACd,GAAmB,MAAfwI,EAAqB,OACzB,MAAM,IAAExB,EAAG,OAAEiM,EAAM,QAAE/N,GAAYsD,GAC3B,IAAEzE,GAAQmB,EAEVd,EAAQyO,EAAK3N,GACnB,OAAa,MAATd,GACJ4C,EAAI5C,EAAOkB,GAEJ,KACL2N,EAAO7O,EAAMH,MACT6O,EAAepQ,SACjBqB,EAAI4J,UAAUvJ,EAAMgF,IAAIzF,EAAGS,EAAMgF,IAAIvF,EAAGO,EAAMgF,IAAIxE,MAAOR,EAAMgF,IAAIvE,QAErEiO,EAAepQ,SAAU,SAR3B,O,0BCnCJ,eACA,SACA,SAEA,SAIEwQ,EAAQC,QAAQ,CACd,gBACED,EAAQE,eAEV,YACErN,OAAOsN,SAASC,YAKtBC,EAASC,OAAO,gBAAC,UAAG,MAAK3S,SAAS4S,eAAe,U,yBClBjD,IAAYjH,EAgBAkH,E,oHAhBZ,SAAYlH,GACV,UACA,UACA,YACA,WACA,WACA,UACA,YACA,YACA,WACA,WACA,WACA,YACA,WAbF,CAAYA,EAAA,EAAAA,YAAA,EAAAA,UAAS,KAgBrB,SAAYkH,GACV,YACA,cACA,YACA,WAJF,CAAYA,EAAA,EAAAA,WAAA,EAAAA,SAAQ,KAkBpB,SAAY5K,GACV,0BACA,sBAFF,CAAY,EAAAA,iBAAA,EAAAA,eAAc,KAe1B,SAAY5G,GACV,oBACA,0BACA,gBACA,gBAJF,CAAY,EAAAA,YAAA,EAAAA,UAAS,KAerB,MAAMuN,EAAgB,GAUb,EAAAA,QART,IAAK,MAAMpK,KAASsO,OAAOC,OAAOpH,GAChC,IAAK,MAAMV,KAAQ6H,OAAOC,OAAOF,GAC/BjE,EAAMvD,KAAK,CAAEJ,OAAMzG,UAIvBsO,OAAOE,OAAOpE,I,wHCxEd,SAAY9S,GACV,mBACA,gBACA,gBACA,uBAJF,CAAY,EAAAA,kBAAA,EAAAA,gBAAe,KAOd,EAAAmX,QAAwD,CAACvN,EAAMnC,KAC1E,IACE2P,aAAaC,QAAQzN,EAAM0N,KAAKC,UAAU9P,IAC1C,MAAO+P,MAKE,EAAAzX,SAAW,CAAI6J,EAAuB6N,KACjD,IACE,MAAMhQ,EAAQ2P,aAAaM,QAAQ9N,IAAS,GAC5C,OAAO0N,KAAKK,MAAMlQ,GAClB,MAAO+P,GACP,OAAOC,K,uBCpBX,IAAYpX,EAKAuX,E,mGALZ,SAAYvX,GACV,gBACA,oBAFF,CAAYA,EAAA,EAAAA,cAAA,EAAAA,YAAW,KAKvB,SAAYuX,GACV,kCACA,wCACA,4CACA,0BACA,4CALF,CAAYA,EAAA,EAAAA,YAAA,EAAAA,UAAS,KAQR,EAAAC,eAAiB,CAACC,EAA0BC,KACvD,IAAIpW,EAAQ,EAeZ,OAdImW,IAAgBzX,EAAYC,SAAWyX,IAAcH,EAAUI,oBACjErW,EAAQ,GAERoW,IAAcH,EAAUK,mBACvBH,IAAgBzX,EAAYwK,OAASkN,IAAcH,EAAUI,qBAC7DF,IAAgBzX,EAAYC,SAAWyX,IAAcH,EAAUM,YAC/DJ,IAAgBzX,EAAYC,SAAWyX,IAAcH,EAAUO,eAEhExW,EAAQ,EACCmW,IAAgBzX,EAAYC,SAAWsX,EAAUQ,oBAC1DzW,GAAS,GACAmW,IAAgBzX,EAAYwK,OAASkN,IAAcH,EAAUQ,sBACtEzW,GAAS,GAEJA,I,sOC7BT,eAGa,EAAA0W,IAAOC,IAClB,MAAMD,EAAM,KAAQ,WAAK,IAAK,GAAMC,EAAI/L,KAAKgM,KAAK,MAAOD,KAAO,WAAK,IAErE,OADAD,IACO,CAACvO,EAAaC,IAAgBwC,KAAKC,MAAM6L,IAAQtO,GAAOD,GAGpD,EAAA0O,eAAkBhD,GAAeA,GAAKA,EAAI,GAAM,EAEhD,EAAAiD,WAAcrT,GAAmCA,EAAMiH,MAAMjH,EAAMiH,MAAM/B,OAAS,IAAM,KAIxF,EAAApK,cAAgB,KAAMwY,OAFnB5O,EAE0B,EAFbC,EAEgB,KAFAwC,KAAKC,MAAMD,KAAKmM,SAAW3O,GAAOD,EAAhE,IAACA,EAAaC,GAShB,EAAA4O,UAAY,CAACC,EAAYC,IAAgBD,EAAIxY,OAASyY,EAAKzY,MAAQwY,EAAItT,QAAUuT,EAAKvT,MAEnG,MAAMwT,EAAW,CAACF,EAAWC,IAAeD,EAAIzJ,OAAS0J,EAAK1J,KAIjD,EAAA4J,SAAW,CAACH,EAAWC,IAFlB,EAACD,EAAWC,IAAeD,EAAIlQ,QAAUmQ,EAAKnQ,MAEbsQ,CAAUJ,EAAKC,IAASC,EAASF,EAAKC,GAE5E,EAAAI,SAAW,CAAC5M,EAAoBwM,IAAwBxM,EAAM6M,MAAK,EAAGpL,KAAM8K,KAAU,EAAAG,SAASH,EAAKC,KAEjH,MAAMM,EAAa,CAACP,EAAWC,IAAeO,EAAWR,EAAIlQ,SAAW0Q,EAAWP,EAAKnQ,OAAS,EAEpF,EAAA2J,MAASvE,GAAe,CAAC,EAAAiJ,SAASsC,QAAS,EAAAtC,SAASuC,OAAOjJ,SAASvC,EAAKqB,MAIzE,EAAAR,MAASb,GACpB,CAAC,EAAA+B,UAAUC,IAAK,EAAAD,UAAUK,KAAM,EAAAL,UAAUM,MAAO,EAAAN,UAAUO,MAAMC,SAASvC,EAAKpF,OAEpE,EAAA6Q,sBAAwB,CAACX,EAAgBC,IAC5C,MAARA,EAAeD,EAAI9K,KAAKpF,QAAU,EAAAmH,UAAUC,IAAMgJ,EAASF,EAAI9K,KAAM+K,EAAK/K,OAASqL,EAAWP,EAAI9K,KAAM+K,EAAK/K,MAElG,EAAA0L,mBAAqB,CAACZ,EAAgBC,IACzC,MAARA,EAAeD,EAAI9K,KAAKpF,QAAU,EAAAmH,UAAUO,KAAO+I,EAAWN,EAAK/K,KAAM8K,EAAI9K,OAT7D,EAAC8K,EAAWC,KAAgB,EAAAxG,MAAMuG,IAAQ,EAAAvG,MAAMwG,GASsBY,CAAUb,EAAI9K,KAAM+K,EAAK/K,MAEjH,MAAMsL,EAAc1Q,GACdA,IAAU,EAAAmH,UAAUC,IAAY,EAChCpH,IAAU,EAAAmH,UAAUK,KAAa,GACjCxH,IAAU,EAAAmH,UAAUM,MAAc,GAClCzH,IAAU,EAAAmH,UAAUO,KAAa,GAC9B9E,SAAS5C,EAAO,K,yICpDzB,eACA,SACA,SACA,OACA,SACA,SACA,SACA,SAEMgR,EAAiB,EAAAC,YAAY,CACjC/P,KAAM,aACNgQ,aAAc,CACZC,MAAO,EACP5Z,OAAQ,EACR0B,MAAO,EACPmW,YAAa,EAAAzX,YAAYC,QACzBkB,QAAS,EACThB,MAAO,EAAAC,gBAAgBC,MAEzBoZ,SAAU,CACR,eAAeC,GACbA,EAAMF,MAAQE,EAAMF,MAAQ,GAE9B,eAAeE,GAAO,QAAEC,IACtBD,EAAMpY,MAAQoY,EAAMpY,MAAQ,EAAAkW,eAAekC,EAAMjC,YAAakC,IAEhE,YAAYD,GAAO,QAAEC,IACnBD,EAAMvZ,MAAQwZ,IAGlBC,cAAgBC,GACdA,EACGC,QAAQ,EAAA1R,YAAY,CAACsR,GAASC,cAC7BD,EAAMF,MAAQ,EACdE,EAAM9Z,OAAS+Z,EAAQ/Z,OACvB8Z,EAAMpY,MAAQqY,EAAQlC,cAAgB,EAAAzX,YAAYwK,MAAQ,EAAA9K,SAAS,EAAAC,gBAAgB2B,MAAO,GAAK,GAAK,EACpGoY,EAAMjC,YAAckC,EAAQlC,YAC5BiC,EAAMvY,QAAU,EAChBuY,EAAMvZ,MAAQwZ,EAAQxZ,SAEvB4Z,YACEC,GACC,EAAAC,WAAWC,MAAMF,KAChBA,EAAOL,QAAQQ,GAAGpa,OAAS,EAAAmF,UAAUC,OACnC6U,EAAOL,QAAQ1G,MAAQ+G,EAAOL,QAAQ1G,KAAKlT,OAAS,EAAAmF,UAAUC,SACnE,CAACuU,GAASC,SAAWQ,KAAInO,aACvB0N,EAAMvY,QACJgZ,EAAGpa,OAAS,EAAAmF,UAAUC,MAAQ+G,KAAKzC,IAAI0Q,EAAGnO,MAAM/B,OAAS+B,EAAM/B,OAAQ,GAAKiC,KAAKxC,IAAI,EAAGgQ,EAAMvY,QAAU,QAKvG,EAAkDkY,EAAee,QAA/D,EAAAC,eAAc,iBAAE,EAAAC,eAAc,iBAAE,EAAAlP,YAAW,cAE1D,UAAe,EAAAmP,SAASlB,EAAemB,U,4ECtDvC,eAEA,GADA,OACA,QAEA,SACA,SACA,SACA,SAEA,OAEMC,EAAa,EAAAC,qBAAqB,CAAEC,gBAAgB,EAAOC,mBAAmB,IAapF,MAAMJ,EAAU,EAAAK,gBAAgB,CAAE/Z,OAAA,UAAQga,UAAA,YACpCra,EAAQ,EAAAsa,eAAe,CAAEP,UAASC,eAExC,UAAUha,EAAO,EAAAua,cAAc,EAAGvD,cAAanW,YACzCmW,IAAgB,EAAAzX,YAAYwK,OAAO,EAAAsM,QAAQ,EAAAnX,gBAAgB2B,MAAOA,MAExE,UAAUb,EAAO,EAAAqK,SAAU2M,GAAgB,EAAAX,QAAQ,EAAAnX,gBAAgBI,KAAM0X,KACzE,UAAUhX,EAAO,EAAAY,UAAWnB,GAAa,EAAA4W,QAAQ,EAAAnX,gBAAgBQ,MAAOD,KACxE,UAAUO,EAAO,EAAAe,WAAY5B,GAAW,EAAAkX,QAAQ,EAAAnX,gBAAgBC,OAAQA,KASxE,UAAea,G,gGCzCf,eAQa,EAAA2H,WACX,EAAA6S,aAKG,e,mVCdL,eACA,SACA,SACA,OAGa,EAAAja,UAAY,EAAAka,gBACtBxB,GAAsBA,EAAM5Y,OAAOqa,QAAQra,SAC3CA,GAAWA,IAGd,MAAMsa,EAAgB,EAAAF,eAAe,EAAAla,WAAYF,GAC/CA,EAAOua,QAAQtW,GAAUA,EAAMhF,OAAS,EAAAmF,UAAU0P,eAGvC,EAAA0G,WAAa,EAAAJ,eAAe,EAAAla,WAAYF,GACnDA,EAAOua,QAAQtW,GAAUA,EAAMhF,OAAS,EAAAmF,UAAU2P,YAGvC,EAAApP,WAAa,EAAAyV,eAAeE,GAAgBxG,GACvDA,EAAW2G,OAAOxW,GAAiC,KAAvBA,EAAMiH,MAAM/B,WAG7B,EAAAuR,cAAgB,EAAAN,eAAe,EAAAI,YAAaxa,GACvDA,EAAOmO,QAA6B,CAACwM,EAAK1W,KACxC,GAAI0W,EAAK,OAAOA,EAChB,MAAMC,EAAU,EAAAtD,WAAWrT,GAC3B,OAAI2W,GAAWA,EAAQhO,OAAe,CAAE3I,QAAOwH,UAAWmP,GACnD,OACN,QAGQ,EAAAC,uBAAyB,EAAAT,eAAe,CAAC,EAAAla,UAAWoa,IAAgB,CAACta,EAAQ8T,IACxF9T,EACGua,QAAQtW,GAAUA,EAAMhF,OAAS,EAAAmF,UAAU0P,aAC3C3F,QAA6B,CAACwM,EAAK1W,KAClC,GAAI0W,EAAK,OAAOA,EAChB,MAAMC,EAAU,EAAAtD,WAAWrT,GAC3B,OAAe,MAAX2W,GAAmBA,EAAQhO,OAAe+N,EAC1C7G,EAAWiE,MAAM+C,GAAM,EAAA1C,sBAAsBwC,EAAS,EAAAtD,WAAWwD,MAAa,CAAE7W,QAAOwH,UAAWmP,GAC/F,OACN,QAGM,EAAAG,SAAW,EAAAX,eACtB,EAAAla,WACCF,GAAWA,EAAOua,QAAQtW,GAAUA,EAAMhF,OAAS,EAAAmF,UAAUE,QAAO,KAG1D,EAAA0W,SAAW,EAAAZ,eACtB,EAAAla,WACCF,GAAWA,EAAOua,QAAQtW,GAAUA,EAAMhF,OAAS,EAAAmF,UAAUC,QAAO,KAG1D,EAAA4W,mBAAqB,EAAAb,eAChCE,GACA,CAACY,EAAYzP,IAAyBA,IACtC,CAACqI,EAAYrI,IAAcqI,EAAWqH,MAAMlX,GAAU,EAAAmU,sBAAsB3M,EAAW,EAAA6L,WAAWrT,QAGvF,EAAAiW,aAAe,EAAAE,gBACzBxB,GAAsBA,EAAMoB,UAAUK,UACtC7Z,GAAUA,IAGA,EAAAD,SAAW,EAAA6Z,eAAe,EAAAF,cAAeF,GAAcA,EAAU3a,QAEjE,EAAAoB,SAAW,EAAA2Z,eAAe,EAAAF,cAAeF,GAAcA,EAAUxZ,QAEjE,EAAAwJ,QAAU,EAAAoQ,eAAe,EAAAF,cAAeF,GAAcA,EAAUrD,cAEhE,EAAAyE,SAAW,EAAAhB,eAAe,EAAAF,cAAeF,GAAcA,EAAUtB,QAGjE,EAAAtY,aAAe,EAAAga,eAC1B,CAAC,EAAAgB,SAAU,EAAApR,UACX,CAAC0O,EAAO/B,IAAgBA,IAAgB,EAAAzX,YAAYwK,OAASgP,EAAQ,EAH9C,IAMZ,EAAApY,WAAa,EAAA8Z,eAAe,EAAAF,cAAc,EAAG7Z,aAAcA,IAE3D,EAAAK,UAAY,EAAA0Z,eAAe,EAAAF,cAAc,EAAGpb,YAAaA,IAEzD,EAAAuc,aAAe,EAAAjB,eAAe,EAAAla,WAAYF,IACrD,MAAMiE,EAAQjE,EAAOmb,MAAMlX,GAA6B,MAAnBA,EAAM4D,YAC3C,OAAI5D,EAAc,CAAEwH,UAAWxH,EAAM4D,UAAW5D,MAAOA,GAChD,QAGI,EAAAqX,mBAAqB,EAAAlB,eAChC,CAAC,EAAAW,SAAU,EAAA3a,eACX,CAACkE,EAAOnE,IAAqC,IAAvBmE,EAAM4G,MAAM/B,QAAgBhJ,K,0LC3FpD,eAEA,SACA,SACA,SACA,SAIMob,EAAc,EAAA/C,YAAY,CAC9B/P,KAAM,SACNgQ,aAAc,CACZzY,OAAQ,CACN,CACEf,KAAM,EAAAmF,UAAUE,MAChByG,UAAW,KACXG,MAAO,GACP/G,MAAO,EACP0D,UAAW,MAEb,CACE5I,KAAM,EAAAmF,UAAUC,MAChB0G,UAAW,EAAAC,eAAeC,WAC1BC,MAAO,GACP/G,MAAO,EACP0D,UAAW,SAEVqK,MAAMC,KAAoB,CAAEhJ,OAAQ,IAAK,CAAC+R,EAAG/W,KAAU,CACxDlF,KAAM,EAAAmF,UAAU2P,QAChBhJ,UAAW,EAAAC,eAAe6I,SAC1B3I,MAAO,GACP/G,QACA0D,UAAW,YAEVqK,MAAMC,KAAoB,CAAEhJ,OAAQ,IAAK,CAAC+R,EAAG/W,KAAU,CACxDlF,KAAM,EAAAmF,UAAU0P,WAChB/I,UAAW,KACXG,MAAO,GACP/G,QACA0D,UAAW,WAIjB8Q,SAAU,CACRQ,WAAY,CAACP,GAASC,SAAW1G,OAAMkH,KAAInO,QAAO0B,cAChD,MAAM4O,EAAU5C,EAAM5Y,OAAOmb,MAAMlX,GAAU,EAAAuT,UAAU6B,EAAIpV,KACrDwX,EAAY7C,EAAM5Y,OAAOmb,MAAMlX,GAAU,EAAAuT,UAAUrF,EAAMlO,KAC3DuX,GAASA,EAAQtQ,MAAMkD,QAAQlD,EAAMlH,KAAK2I,GAAU,OAAD,wBAAMA,GAAI,CAAElL,UAAU,EAAOmL,cAChF6O,IAAWA,EAAUvQ,MAAQuQ,EAAUvQ,MAAMqP,QAAQ9O,IAAe,EAAAqM,SAAS5M,EAAOO,EAAUkB,UAEpG+O,UAAW,CAAC9C,GAASC,cACnB,MAAM8C,EAAY/C,EAAM5Y,OAAOmb,MAAMlX,GAAU,EAAAuT,UAAUvT,EAAO4U,KAChE,GAAI8C,EAAW,CACb,MAAMf,EAAUe,EAAUzQ,MAAMyQ,EAAUzQ,MAAM/B,OAAS,GACrDyR,IAASA,EAAQhO,QAAS,KAGlCgP,WAAY,CAAChD,GAASC,SAAW5U,QAAOwH,iBACtC,MAAMkQ,EAAY/C,EAAM5Y,OAAOmb,MAAM1D,GAAQ,EAAAD,UAAUC,EAAKxT,KAC5D,GAAI0X,EAAW,CACbA,EAAU9T,UAAY4D,EACtB,MAAMoQ,EAAWF,EAAUzQ,MAAMiQ,MAAM1D,GAAQ,EAAAG,SAASH,EAAI9K,KAAMlB,EAAUkB,QACxEkP,IAAUA,EAASpa,UAAW,KAGtCqa,aAAelD,IACb,MAAM+C,EAAY/C,EAAM5Y,OAAOmb,MAAMlX,GAA6B,MAAnBA,EAAM4D,YACrD,GAAI8T,EAAW,CACbA,EAAU9T,UAAY,KACtB,MAAMkU,EAAeJ,EAAUzQ,MAAMiQ,MAAM1P,GAAcA,EAAUhK,WAC/Dsa,IAAcA,EAAata,UAAW,MAIhDqX,cAAgBC,GACdA,EAAQC,QAAQ,EAAA1R,YAAY,CAACsR,GAASC,cACpCD,EAAM5Y,OAAS4Y,EAAM5Y,OAAOgE,KAAKC,IAC/B,OAAQA,EAAMhF,MACZ,KAAK,EAAAmF,UAAU0P,WACf,KAAK,EAAA1P,UAAUC,MACb,OAAO,OAAP,wBAAYJ,GAAK,CAAEiH,MAAO,KAC5B,KAAK,EAAA9G,UAAUE,MACb,OAAO,OAAP,wBAAYL,GAAK,CAAEiH,MAAO2N,EAAQ3N,MAAMC,MAAM,EAAG,IAAInH,KAAK2I,IAAS,CAAGA,OAAMC,QAAQ,QACtF,KAAK,EAAAxI,UAAU2P,QACb,OAAO,OAAP,wBACK9P,GAAK,CACRiH,MAAO2N,EAAQ3N,MACZC,MAAM,GAAK,EAAAkM,eAAepT,EAAME,OAAQ,GAAK,EAAAkT,eAAepT,EAAME,OAASF,EAAME,MAAQ,GACzFH,KAAI,CAAC2I,EAAMxI,EAAO6X,KAAM,CAAGrP,OAAMC,OAAQoP,EAAE7S,SAAWhF,EAAQ,iBAOlE,EAAsDoX,EAAYjC,QAAhE,EAAAsC,WAAU,aAAE,EAAAE,aAAY,eAAE,EAAAJ,UAAS,YAAE,EAAAvC,WAAU,aAEjD,EAAA8C,UAAY,CAAC9J,EAAakH,EAAW6C,IAChD,EAAA/C,WAAW,CACThH,OACAkH,KACAnO,MAAOiH,EAAKjH,MAAMC,MAAMgH,EAAKjH,MAAMiR,WAAWxP,GAASuP,GAAa,EAAAtE,SAASjL,EAAKA,KAAMuP,EAAUvP,SAClGC,QAAQ,IAGC,EAAAwP,eAAiB,EAAG9X,QAAOD,WACtC,EAAA8U,WAAW,CAAEhH,KAAM7N,EAAO+U,GAAIhV,EAAO6G,MAAO5G,EAAM4G,MAAMC,OAAO,GAAGkR,UAAWzP,QAAQ,IAE1E,EAAA0P,aAAe,EAAGhY,QAAOD,WACpC,EAAA8U,WAAW,CAAEhH,KAAM9N,EAAOgV,GAAI/U,EAAO4G,MAAO7G,EAAM6G,MAAMC,MAAM,GAAGkR,UAAWzP,QAAQ,IAEtF,UAAe,EAAA6M,SAAS8B,EAAY7B,U,uKC9GpC,eACA,SACA,OAGA,SACA,SACA,SAYA,SACA,SAEa,EAAA1a,QAAWA,GAA0B,EAAAS,eAAe,CAAEd,UAAW,EAAAI,gBAAiBC,YAElF,EAAAL,UAAaA,GACxB,EAAAc,eAAe,CAAEd,UAAwB,MAAbA,EAAoB,EAAAI,gBAAkBJ,IAIvD,EAAAc,eACX,EAAGT,UAASL,YAAWS,cACvB,CAACI,EAAU+c,KACT,MAAMzd,EAAsB,MAAbH,EAAoB,EAAA+B,UAAU6b,KAAc5d,EACrDgY,EAAyB,MAAX3X,EAAkB,EAAAgL,QAAQuS,KAAcvd,EACtDK,EAAoB,MAAZD,EAAmB,EAAAmB,SAASgc,KAAcnd,EAElDod,EAAiBtK,MAAMC,KAAK,EAAAR,OAC5BzG,EAAgB,GAEhBuR,EAAQ,EAAAvF,IAAIpY,GAElB,IAAK,IAAIuV,EAAI,EAAGA,EAAI,GAAIA,GAAK,EAAG,CAC9B,MAAMlQ,EAAQsY,EAAM,EAAGD,EAAerT,SAC/BwD,GAAQ6P,EAAeE,OAAOvY,EAAO,GAC5C+G,EAAMkD,KAAKzB,GAGbnN,EAAS,EAAA8H,WAAW,CAAEqP,cAAazL,QAAOpM,SAAQO,YAGzC,EAAAkD,aAAe,IAAgB,CAAC/C,EAAU+c,K,QACrD,IAAII,EACJ,KAAQA,EAAU,EAAA9B,uBAAuB0B,MAAe,EAAA7B,cAAc6B,MACvC,QAAzB,EAAiB,QAAjB,EAAAI,EAAQlR,iBAAS,eAAEmB,cAAM,SAC3BpN,EAASod,EAA0BD,IAEnCnd,EAASqd,EAA8BF,KAK7C,MAAMC,EACH/U,GACArI,IACkB,MAAbqI,IACJrI,EAAS,EAAAsd,cACTtd,EAAS,EAAAga,eAAe,EAAA/C,UAAUM,aAClCvX,EAAS,EAAAkc,UAAU7T,EAAU5D,UAG3B4Y,EACHhV,GACD,CAACrI,EAAU+c,KACT,MAAMzI,EAAajM,EAAU4D,WAAa,EAAAwP,mBAAmBsB,IAAY1U,EAAU4D,WAC/EqI,GAAcjM,EAAU4D,YAC1BjM,EAAS,EAAAsc,gBACTtc,EAAS,EAAAsd,cACLjV,EAAU5D,MAAMhF,OAAS,EAAAmF,UAAUC,OAAO7E,EAAS,EAAAga,eAAe,EAAA/C,UAAUK,oBAC5EjP,EAAU5D,MAAMhF,OAAS,EAAAmF,UAAU2P,SAASvU,EAAS,EAAAga,eAAe,EAAA/C,UAAUI,sBAClFrX,EAAS,EAAAyc,UAAUpU,EAAU5D,MAAO6P,EAAYjM,EAAU4D,cAInD,EAAAC,UACVqR,GACD,CAACvd,EAAU+c,KACT,MAAM,UAAE9Q,EAAS,MAAExH,GAAU8Y,EAC7B,GAAiB,MAAbtR,GAAqBA,EAAUhK,SAAU,OAAOjC,EAAS,EAAAsc,gBAE7D,MAAMjU,EAAY,EAAAwT,aAAakB,KAC/B,GAAiB,MAAb1U,GAAqB4D,IAAcA,EAAUmB,OAAQ,OAAOpN,EAAS,EAAAoc,WAAW,CAAE3X,QAAOwH,eAE7F,GAAIxH,EAAMhF,OAAS,EAAAmF,UAAU0P,YAAcjM,EACzCrI,EAASqd,EAA8BhV,SAmBzC,GAfI5D,EAAMhF,OAAS,EAAAmF,UAAU2P,UACV,MAAblM,GAAqB4D,GAAaA,EAAUmB,SAC9CpN,EAAS,EAAAsd,cACTtd,EAAS,EAAAga,eAAe,EAAA/C,UAAUM,aAClCvX,EAAS,EAAAkc,UAAUzX,KAEjB4D,GAAaA,EAAU4D,WAAa,EAAA4M,mBAAmBxQ,EAAU4D,UAAWA,KAC9EjM,EAAS,EAAAsc,gBACTtc,EAAS,EAAAsd,cACLjV,EAAU5D,MAAMhF,OAAS,EAAAmF,UAAUC,OAAO7E,EAAS,EAAAga,eAAe,EAAA/C,UAAUO,iBAC5EnP,EAAU5D,MAAMhF,OAAS,EAAAmF,UAAU0P,YAAYtU,EAAS,EAAAga,eAAe,EAAA/C,UAAUQ,sBACrFzX,EAAS,EAAAyc,UAAUpU,EAAU5D,MAAOA,EAAO4D,EAAU4D,cAIrDxH,EAAMhF,OAAS,EAAAmF,UAAUE,MAAO,CAClC,GAAI,EAAAgX,mBAAmBiB,KAAa,OAChC1U,GAAWrI,EAAS,EAAAsc,gBACxB,MAAMzX,EAAQ,EAAA2W,SAASuB,KACjBjY,EAAQ,EAAAyW,SAASwB,KACvB/c,EAAS,EAAAsd,cACLxY,EAAM4G,MAAM/B,OAAS,EACvB3J,EAAS,EAAA4c,eAAe,CAAE9X,QAAOD,YAEjC7E,EAAS,EAAA8c,aAAa,CAAEhY,QAAOD,WAC/B7E,EAAS,EAAA+Z,qBAKJ,EAAA/N,gBACVuR,GACAvd,IACC,MAAM,MAAEyE,EAAK,UAAEwH,GAAcsR,EAE3B9Y,EAAMhF,OAAS,EAAAmF,UAAU0P,YACzB7P,EAAMhF,OAAS,EAAAmF,UAAUE,OACZ,MAAbmH,GACkB,MAAlBA,EAAUkB,MAKZnN,EAASqd,EAA8B,CAAE5Y,QAAOwH,iB,mIC7IpD,eASa,EAAAzG,QAAU,EAAAmV,aAAa,WACvB,EAAArX,KAAO,EAAAqX,aAAa,QACpB,EAAAtX,KAAO,EAAAsX,aAAa,QACpB,EAAA2C,WAAa,EAAA3C,aAAa,cAE1B,EAAAV,SAAoCC,IAC/C,MAAMjB,EAA2B,CAC/BuE,KAAM,GACN3C,QAASX,OAAQ,EAAQ,IACzBuD,OAAQ,IAGV,MAAO,CAACrE,EAAQH,EAAcS,KAC5B,MAAM,KAAE8D,EAAI,QAAE3C,EAAO,OAAE4C,GAAWrE,EAElC,GAAI,EAAA9V,KAAKsW,MAAMF,GAAS,CACtB,MAAMgE,EAAWF,EAAKA,EAAK7T,OAAS,GACpC,IAAK+T,EACH,OAAOtE,EAIT,MAAO,CACLoE,KAFcA,EAAK7R,MAAM,EAAG6R,EAAK7T,OAAS,GAG1CkR,QAAS6C,EACTD,OAAQ,CAAC5C,KAAY4C,IAIzB,GAAI,EAAApa,KAAKuW,MAAMF,GAAS,CACtB,MAAMiE,EAAOF,EAAO,GACpB,IAAKE,EACH,OAAOvE,EAGT,MAAMwE,EAAYH,EAAO9R,MAAM,GAC/B,MAAO,CACL6R,KAAM,IAAIA,EAAM3C,GAChBA,QAAS8C,EACTF,OAAQG,GAIZ,MAAMC,EAAa3D,EAAQW,EAASnB,GAEpC,OAAI,EAAAlU,QAAQoU,MAAMF,GACT,CACL8D,KAAM,GACN3C,QAASgD,EACTJ,OAAQ,IAIR,EAAAH,WAAW1D,MAAMF,GACZ,CACL8D,KAAM,IAAIA,EAAM3C,GAChBA,QAASgD,EACTJ,OAAQ,IAIR5C,IAAYgD,EACPzE,EAGF,CACLoE,OACA3C,QAASgD,EACTJ,cC5EFK,EAA2B,GAG/B,SAASC,EAAoBC,GAE5B,IAAIC,EAAeH,EAAyBE,GAC5C,QAAqBE,IAAjBD,EACH,OAAOA,EAAahf,QAGrB,IAAID,EAAS8e,EAAyBE,GAAY,CAGjD/e,QAAS,IAOV,OAHAkf,EAAoBH,GAAUI,KAAKpf,EAAOC,QAASD,EAAQA,EAAOC,QAAS8e,GAGpE/e,EAAOC,QAIf8e,EAAoBM,EAAIF,E5BzBpBpf,EAAW,GACfgf,EAAoBO,EAAI,CAACC,EAAQC,EAAUC,EAAIC,KAC9C,IAAGF,EAAH,CAMA,IAAIG,EAAe1T,IACnB,IAAS4J,EAAI,EAAGA,EAAI9V,EAAS4K,OAAQkL,IAAK,CAGzC,IAFA,IAAK2J,EAAUC,EAAIC,GAAY3f,EAAS8V,GACpC+J,GAAY,EACPC,EAAI,EAAGA,EAAIL,EAAS7U,OAAQkV,MACpB,EAAXH,GAAsBC,GAAgBD,IAAarI,OAAOzP,KAAKmX,EAAoBO,GAAGrD,OAAOvW,GAASqZ,EAAoBO,EAAE5Z,GAAK8Z,EAASK,MAC9IL,EAAStB,OAAO2B,IAAK,IAErBD,GAAY,EACTF,EAAWC,IAAcA,EAAeD,IAG1CE,IACF7f,EAASme,OAAOrI,IAAK,GACrB0J,EAASE,KAGX,OAAOF,EAtBNG,EAAWA,GAAY,EACvB,IAAI,IAAI7J,EAAI9V,EAAS4K,OAAQkL,EAAI,GAAK9V,EAAS8V,EAAI,GAAG,GAAK6J,EAAU7J,IAAK9V,EAAS8V,GAAK9V,EAAS8V,EAAI,GACrG9V,EAAS8V,GAAK,CAAC2J,EAAUC,EAAIC,I6BJ/BX,EAAoBe,EAAK9f,IACxB,IAAI+f,EAAS/f,GAAUA,EAAOggB,WAC7B,IAAOhgB,EAAiB,QACxB,IAAM,EAEP,OADA+e,EAAoBkB,EAAEF,EAAQ,CAAEvC,EAAGuC,IAC5BA,GCLRhB,EAAoBkB,EAAI,CAAChgB,EAASigB,KACjC,IAAI,IAAIxa,KAAOwa,EACXnB,EAAoBoB,EAAED,EAAYxa,KAASqZ,EAAoBoB,EAAElgB,EAASyF,IAC5E2R,OAAO+I,eAAengB,EAASyF,EAAK,CAAE2a,YAAY,EAAMtY,IAAKmY,EAAWxa,MCJ3EqZ,EAAoBuB,EAAI,WACvB,GAA0B,iBAAfC,WAAyB,OAAOA,WAC3C,IACC,OAAOC,MAAQ,IAAIC,SAAS,cAAb,GACd,MAAO7c,GACR,GAAsB,iBAAX6F,OAAqB,OAAOA,QALjB,GCAxBsV,EAAoBoB,EAAI,CAACO,EAAKpU,IAAU+K,OAAOsJ,UAAUC,eAAexB,KAAKsB,EAAKpU,GCClFyS,EAAoB8B,EAAK5gB,IACH,oBAAX6gB,QAA0BA,OAAOC,aAC1C1J,OAAO+I,eAAengB,EAAS6gB,OAAOC,YAAa,CAAEhY,MAAO,WAE7DsO,OAAO+I,eAAengB,EAAS,aAAc,CAAE8I,OAAO,K,MCAvD,IAAIiY,EAAkB,CACrBC,IAAK,GAaNlC,EAAoBO,EAAEO,EAAKqB,GAA0C,IAA7BF,EAAgBE,GAGxD,IAAIC,EAAuB,CAACC,EAA4B/N,KACvD,IAGI2L,EAAUkC,GAHT1B,EAAU6B,EAAaC,GAAWjO,EAGhBwC,EAAI,EAC3B,IAAImJ,KAAYqC,EACZtC,EAAoBoB,EAAEkB,EAAarC,KACrCD,EAAoBM,EAAEL,GAAYqC,EAAYrC,IAGhD,GAAGsC,EAAS,IAAI/B,EAAS+B,EAAQvC,GAEjC,IADGqC,GAA4BA,EAA2B/N,GACrDwC,EAAI2J,EAAS7U,OAAQkL,IACzBqL,EAAU1B,EAAS3J,GAChBkJ,EAAoBoB,EAAEa,EAAiBE,IAAYF,EAAgBE,IACrEF,EAAgBE,GAAS,KAE1BF,EAAgBxB,EAAS3J,IAAM,EAEhC,OAAOkJ,EAAoBO,EAAEC,IAG1BgC,EAAqBC,KAA2B,qBAAIA,KAA2B,sBAAK,GACxFD,EAAmBjW,QAAQ6V,EAAqBM,KAAK,KAAM,IAC3DF,EAAmB3R,KAAOuR,EAAqBM,KAAK,KAAMF,EAAmB3R,KAAK6R,KAAKF,K,GC3CvF,IAAIG,EAAsB3C,EAAoBO,OAAEJ,EAAW,CAAC,MAAM,IAAOH,EAAoB,MAC7F2C,EAAsB3C,EAAoBO,EAAEoC,I","file":"klondike.f17419de27731335088b.js","sourcesContent":["var deferred = [];\n__webpack_require__.O = (result, chunkIds, fn, priority) => {\n\tif(chunkIds) {\n\t\tpriority = priority || 0;\n\t\tfor(var i = deferred.length; i > 0 && deferred[i - 1][2] > priority; i--) deferred[i] = deferred[i - 1];\n\t\tdeferred[i] = [chunkIds, fn, priority];\n\t\treturn;\n\t}\n\tvar notFulfilled = Infinity;\n\tfor (var i = 0; i < deferred.length; i++) {\n\t\tvar [chunkIds, fn, priority] = deferred[i];\n\t\tvar fulfilled = true;\n\t\tfor (var j = 0; j < chunkIds.length; j++) {\n\t\t\tif ((priority & 1 === 0 || notFulfilled >= priority) && Object.keys(__webpack_require__.O).every((key) => (__webpack_require__.O[key](chunkIds[j])))) {\n\t\t\t\tchunkIds.splice(j--, 1);\n\t\t\t} else {\n\t\t\t\tfulfilled = false;\n\t\t\t\tif(priority < notFulfilled) notFulfilled = priority;\n\t\t\t}\n\t\t}\n\t\tif(fulfilled) {\n\t\t\tdeferred.splice(i--, 1)\n\t\t\tresult = fn();\n\t\t}\n\t}\n\treturn result;\n};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"topBar\":\"XwVLUrO3NoD_AUivFS56j\",\"fireworks\":\"_3nvOdthckw9G8z05Xiav92\",\"game\":\"_1VoMUOf1IbpEJjbCNdZsU9\",\"button\":\"OktEGbV1DqgG2_sQ16MRl\",\"label\":\"_1HEad0y2SdUmqeXvzo2hG6\",\"optionsMask\":\"_27aor1u7u5hz8M4_9poVe8\",\"optionsModal\":\"_3gKGSm81FK9xUP7Tx5P_-n\"};","import * as React from 'react'\n\nimport { Provider } from 'react-redux'\n\nimport Container from './Container'\nimport { retrieve, PersistanceType } from '../lib/Persist'\nimport { ScoringType } from '../lib/Scoring'\nimport { ColorSchemeType } from '../drawing/ColorScheme'\nimport store from '../redux'\nimport { initializeGame } from '../redux/thunks'\nimport { newGameNumber } from '../lib/util'\n\nconst App: React.FC = () => {\n  const newNumber = retrieve(PersistanceType.number, newGameNumber())\n  const newType = retrieve<ScoringType>(PersistanceType.type, ScoringType.regular)\n  const newTheme = retrieve<ColorSchemeType>(PersistanceType.theme, ColorSchemeType.dark)\n\n  store.dispatch(initializeGame({ newType, newNumber, newTheme }))\n\n  return (\n    <Provider store={store}>\n      <Container />\n    </Provider>\n  )\n}\n\nexport { App }\n\nexport default React.memo(App)\n","import * as React from 'react'\nimport { hot } from 'react-hot-loader/root'\nimport { useDispatch, useSelector } from 'react-redux'\n\nimport { StackType } from '../lib/Card'\nimport { colorSchemes } from '../drawing/ColorScheme'\nimport { label, topBar, game, optionsMask, optionsModal, button } from '../css/index.css'\n\nimport FireworksComponent from './Fireworks'\nimport GameCanvas from './GameCanvas'\nimport StackElement from './StackElement'\nimport Options from './Options'\n\nimport { performMoves, newNumber } from '../redux/thunks'\nimport { undo, redo } from '../redux/undoable'\nimport { getOverDrawn, getShowing, getStacks, getTheme, getScore, getNumber } from '../redux/selectors'\n\nconst Container: React.FC = () => {\n  const dispatch = useDispatch()\n  const stacks = useSelector(getStacks)\n  const overDrawn = useSelector(getOverDrawn)\n  const showing = useSelector(getShowing)\n  const theme = useSelector(getTheme)\n  const score = useSelector(getScore)\n  const number = useSelector(getNumber)\n\n  const cssVars = React.useMemo(() => {\n    const colors = colorSchemes[theme]\n    return {\n      '--background': colors.background,\n      '--color': colors.color,\n      '--emptyColor': colors.emptyColor,\n      '--faceUp': colors.faceUp,\n      '--hiddenColor1': colors.hiddenColor1,\n      '--hiddenColor2': colors.hiddenColor2,\n      '--buttonBorder': colors.buttonBorder,\n      '--cardBorder': colors.cardBorder,\n      '--black': colors.black,\n      '--red': colors.red,\n      '--selected': colors.selected,\n      '--errorColor': colors.errorColor,\n    }\n  }, [theme])\n\n  const [showOptions, setShowOptions] = React.useState(false)\n\n  const handleCloseOptions = React.useCallback(() => setShowOptions(false), [])\n  const handleShowOptions = React.useCallback(() => setShowOptions(true), [])\n  const handleNewGame = React.useCallback(() => dispatch(newNumber()), [dispatch])\n\n  React.useEffect(() => {\n    const handleMouseDown = (e: MouseEvent) => {\n      if (e.button !== 1) return\n      e.preventDefault()\n      dispatch(performMoves())\n    }\n    const handleKeyDown = (e: KeyboardEvent) => {\n      if (e.code === 'F2') dispatch(newNumber())\n      if (e.code === 'Escape') setShowOptions((prev) => !prev)\n      if (e.code === 'KeyZ' && e.ctrlKey) {\n        if (e.shiftKey) {\n          dispatch(redo())\n        } else {\n          dispatch(undo())\n        }\n      }\n    }\n    document.addEventListener('mousedown', handleMouseDown)\n    document.addEventListener('keydown', handleKeyDown)\n    return () => {\n      document.removeEventListener('mousedown', handleMouseDown)\n      document.removeEventListener('keydown', handleKeyDown)\n    }\n  }, [dispatch])\n\n  return (\n    <div style={cssVars}>\n      <FireworksComponent />\n      {showOptions && (\n        <>\n          <Options onClose={handleCloseOptions} className={optionsModal} />\n          <div onClick={handleCloseOptions} className={optionsMask} />\n        </>\n      )}\n      <div className={topBar}>\n        <div>\n          <button title=\"New Game\" tabIndex={1} onClick={handleNewGame} className={button}>\n            <span aria-hidden=\"true\">🔄︎</span>\n            <span style={{ display: 'none' }}>New Game</span>\n          </button>\n          <span title=\"Game Number\" className={label}>\n            {String(number).padStart(4, '0')}\n          </span>\n        </div>\n        <div>\n          <span title=\"Score\" className={label}>\n            {score}\n          </span>\n          <button title=\"Main Menu\" tabIndex={1} onClick={handleShowOptions} className={button}>\n            <span aria-hidden=\"true\">☰︎</span>\n            <span style={{ display: 'none' }}>Main Menu</span>\n          </button>\n        </div>\n      </div>\n      <GameCanvas className={game}>\n        {stacks.map((stack) => (\n          <StackElement\n            key={`${stack.type}-${stack.index}`}\n            stack={stack}\n            {...(stack.type === StackType.waste && { showing })}\n            {...(stack.type === StackType.stock && { overDrawn })}\n          />\n        ))}\n      </GameCanvas>\n    </div>\n  )\n}\n\nexport default hot(React.memo(Container))\n","import * as React from 'react'\nimport { useSelector } from 'react-redux'\nimport * as FireworksCanvas from 'fireworks-canvas'\nimport { getGameWon } from '../redux/selectors'\nimport { fireworks } from '../css/index.css'\n\nconst Fireworks: React.FC = () => {\n  const ref = React.useRef<HTMLDivElement>(null)\n  const fireworksObj = React.useRef<FireworksCanvas>()\n  const active = useSelector(getGameWon)\n  const display = active ? '' : 'none'\n\n  React.useEffect(() => {\n    if (ref.current == null) return\n    fireworksObj.current = new FireworksCanvas(ref.current)\n\n    const handleDocumentKeyDown = (ev: KeyboardEvent) => {\n      if (ev.key === 'Escape') fireworksObj.current?.stop()\n    }\n\n    document.addEventListener('keydown', handleDocumentKeyDown)\n\n    return () => {\n      fireworksObj.current?.destroy()\n    }\n  }, [ref, active])\n\n  React.useEffect(() => {\n    if (active) {\n      fireworksObj.current?.start()\n    } else {\n      fireworksObj.current?.stop()\n    }\n  }, [active])\n\n  return <div className={fireworks} style={{ display, zIndex: 5 }} ref={ref} />\n}\n\nexport default React.memo(Fireworks)\n","import * as React from 'react'\nimport { Drawable, DrawingContext, Clickable, Handler } from '../drawing/Common'\nimport { colorSchemes } from '../drawing/ColorScheme'\nimport { initialize } from '../drawing/Common'\nimport { useCanvasSize } from '../hooks/useCanvasSize'\nimport { useSelector } from 'react-redux'\nimport { getTheme } from '../redux/selectors'\n\nexport type GameContext = {\n  context: DrawingContext\n  add: (thing: Drawable, events: Clickable) => void\n  remove: (path: Path2D) => void\n}\n\nexport const GameCtx = React.createContext<GameContext | null>(null)\n\nconst intersect = (evt: React.MouseEvent<HTMLCanvasElement>, pointsRef: Map<Path2D, Drawable>) => {\n  const { nativeEvent: e } = evt\n  const canvas = e.target as HTMLCanvasElement\n  const point = { x: e.offsetX, y: e.offsetY }\n  const ctx = canvas.getContext('2d')\n  for (const path of pointsRef.keys())\n    if (ctx?.isPointInPath(path, point.x, point.y)) {\n      const thing = pointsRef.get(path)\n      if (thing == null) return\n      return { thing, point }\n    }\n}\n\nconst GameCanvas: React.FC<React.HTMLAttributes<HTMLCanvasElement>> = ({ children, ...rest }) => {\n  const pointsRef = React.useRef<Map<Path2D, Drawable>>(new Map())\n  const clickHandlers = React.useRef<Map<Path2D, Handler>>(new Map())\n  const doubleClickHandlers = React.useRef<Map<Path2D, Handler>>(new Map())\n\n  const { ctx, width, height, handleCanvasRef } = useCanvasSize()\n  const colorSchemeType = useSelector(getTheme)\n  const colorScheme = colorSchemes[colorSchemeType]\n\n  const context = React.useMemo<DrawingContext | null>(() => {\n    if (!width || !height || !ctx) return null\n    return { ctx, width, height, colorSchemeType, colorScheme }\n  }, [ctx, width, height, colorSchemeType, colorScheme])\n\n  React.useLayoutEffect(() => (context && initialize(context)) || void 0, [context])\n\n  const value = React.useMemo<GameContext | null>(\n    () =>\n      context && {\n        context,\n        add(thing, events) {\n          pointsRef.current.set(thing.path, thing)\n          if (events.onClick) clickHandlers.current.set(thing.path, events.onClick)\n          if (events.onDoubleClick) doubleClickHandlers.current.set(thing.path, events.onDoubleClick)\n        },\n        remove(path: Path2D) {\n          pointsRef.current.delete(path)\n          clickHandlers.current.delete(path)\n          doubleClickHandlers.current.delete(path)\n        },\n      },\n    [context],\n  )\n\n  const handleCanvasDoubleClick = React.useCallback((evt: React.MouseEvent<HTMLCanvasElement>) => {\n    const selection = intersect(evt, pointsRef.current)\n    if (selection) {\n      const { thing, point } = selection\n      const event = doubleClickHandlers.current.get(thing.path)\n      if (event) event(thing, point)\n    }\n  }, [])\n\n  const handleCanvasClick = React.useCallback((evt: React.MouseEvent<HTMLCanvasElement>) => {\n    const selection = intersect(evt, pointsRef.current)\n    if (selection) {\n      const { thing, point } = selection\n      const event = clickHandlers.current.get(thing.path)\n      if (event) event(thing, point)\n    }\n  }, [])\n\n  return (\n    <>\n      <canvas\n        id=\"canvas\"\n        ref={handleCanvasRef}\n        width={window.innerWidth}\n        height={window.innerHeight}\n        onClick={handleCanvasClick}\n        onDoubleClick={handleCanvasDoubleClick}\n        {...rest}\n      />\n      <GameCtx.Provider value={value}>{children}</GameCtx.Provider>\n    </>\n  )\n}\n\nexport { GameCanvas }\nexport default React.memo(GameCanvas)\n","import * as React from 'react'\nimport { useSelector, useDispatch } from 'react-redux'\nimport { ScoringType } from '../lib/Scoring'\nimport { ColorSchemeType } from '../drawing/ColorScheme'\nimport { getType, getTheme, getNumber } from '../redux/selectors'\nimport { changeTheme } from '../redux/game-state'\nimport { newNumber, newType } from '../redux/thunks'\n\nconst submitCallbacks: Set<() => void> = new Set()\nexport const OptionCtx = React.createContext(submitCallbacks)\n\ntype OptionType = React.HTMLAttributes<HTMLFieldSetElement> & {\n  name: string\n  label: string\n  value: unknown\n  onChange: (arg0: unknown) => void\n  options?: [string, unknown][]\n  type?: string\n  min?: number\n  max?: number\n}\n\nconst Option: React.FC<OptionType> = React.memo(\n  ({ value, onChange, name, options = [], label, min, max, type = 'text', ...props }) => {\n    const [newValue, setValue] = React.useState(value)\n\n    const handleChange = React.useCallback((e: React.ChangeEvent<HTMLInputElement>) => setValue(e.target.value), [])\n\n    const handleSubmit = React.useCallback(() => {\n      if (newValue !== value) onChange(newValue)\n    }, [value, newValue, onChange])\n\n    React.useEffect(() => {\n      submitCallbacks.add(handleSubmit)\n      return () => {\n        submitCallbacks.delete(handleSubmit)\n      }\n    })\n\n    return (\n      <fieldset {...props}>\n        <legend>{label}</legend>\n        {options.length === 0 ? (\n          <div>\n            <label htmlFor={`option-${name}`} style={{ display: 'none' }}>\n              {label}\n            </label>\n            <input\n              type={type}\n              id={`option-${name}`}\n              value={String(newValue)}\n              onChange={handleChange}\n              {...(min && { min })}\n              {...(max && { max })}\n            />\n          </div>\n        ) : (\n          options.map(([label, option]) => (\n            <div key={label.toString()}>\n              <input\n                type=\"radio\"\n                id={`${name}-${label}`}\n                checked={newValue === option}\n                value={String(option)}\n                onChange={handleChange}\n              />\n              <label htmlFor={`${name}-${label}`}>{label}</label>\n            </div>\n          ))\n        )}\n      </fieldset>\n    )\n  },\n)\n\nOption.displayName = 'Option'\n\nconst typeOptions: [string, ScoringType][] = [\n  ['Regular', ScoringType.regular],\n  ['Vegas', ScoringType.vegas],\n]\n\nconst colorSchemeOptions: [string, ColorSchemeType][] = [\n  ['Dark', ColorSchemeType.dark],\n  ['Light', ColorSchemeType.light],\n]\n\ntype OptionContainerProps = { onClose(): void } & React.HTMLAttributes<HTMLFormElement>\n\nconst Options: React.FC<OptionContainerProps> = React.memo(({ onClose, ...props }) => {\n  const handleSubmit = React.useCallback(\n    (e: React.FormEvent) => {\n      e.preventDefault()\n      submitCallbacks.forEach((cb) => cb())\n      onClose()\n    },\n    [onClose],\n  )\n\n  const dispatch = useDispatch()\n  const type = useSelector(getType)\n  const theme = useSelector(getTheme)\n  const gameNumber = useSelector(getNumber)\n\n  const handleNewNumber = React.useCallback((number) => dispatch(newNumber(parseInt(number, 10))), [dispatch])\n  const handleNewType = React.useCallback((type) => dispatch(newType(type)), [dispatch])\n  const handleNewTheme = React.useCallback((theme) => dispatch(changeTheme(theme)), [dispatch])\n\n  return (\n    <form onSubmit={handleSubmit} {...props}>\n      <Option\n        name=\"game-number\"\n        label=\"Game Number\"\n        type=\"number\"\n        min={1}\n        max={9999}\n        value={gameNumber}\n        onChange={handleNewNumber}\n      />\n      <Option name=\"type\" label=\"Game Type\" value={type} onChange={handleNewType} options={typeOptions} />\n      <Option name=\"theme\" label=\"Theme\" value={theme} onChange={handleNewTheme} options={colorSchemeOptions} />\n      <button type=\"submit\">Save</button>\n    </form>\n  )\n})\n\nOptions.displayName = 'OptionContainer'\n\nexport { Options }\nexport default React.memo(Options)\n","import * as React from 'react'\nimport { GameCtx } from './GameCanvas'\nimport { drawStack, StackDrawingContext, getStackDrawingContext } from '../drawing/Stack'\nimport { Stack, StackDirection, StackType } from '../lib/Card'\nimport { useDispatch } from 'react-redux'\nimport { clickCard, doubleClickCard } from '../redux/thunks'\nimport { Point, Drawable } from '../drawing/Common'\nimport { useDrawing } from '../hooks/useDrawing'\nimport { useMemo } from 'react'\n\nconst StackElement: React.FC<{\n  stack: Stack\n  overDrawn?: boolean\n  showing?: number\n}> = ({ stack, overDrawn = false, showing = Infinity }) => {\n  const dispatch = useDispatch()\n  const gameContext = React.useContext(GameCtx)\n\n  const drawingOpts = useMemo<StackDrawingContext | null>(\n    () => gameContext && getStackDrawingContext(gameContext.context, stack, { overDrawn, showing }),\n    [gameContext, stack, overDrawn, showing],\n  )\n\n  const onDoubleClick = React.useCallback(\n    (thing: Drawable, point: Point) => {\n      if (gameContext == null || drawingOpts == null) return\n      const prop = stack.direction === StackDirection.horizontal ? 'x' : 'y'\n      const cards = stack.cards.slice(-drawingOpts.max)\n      const index = Math.min(cards.length - 1, Math.floor((point[prop] - drawingOpts.box[prop]) / drawingOpts.space))\n      if (stack.type !== StackType.waste || index === cards.length - 1)\n        dispatch(doubleClickCard({ stack, stackCard: cards[index] }))\n    },\n    [dispatch, gameContext, drawingOpts, stack],\n  )\n\n  const onClick = React.useCallback(\n    (thing: Drawable, point: Point) => {\n      if (gameContext == null || drawingOpts == null) return\n      const prop = stack.direction === StackDirection.horizontal ? 'x' : 'y'\n      const cards = stack.cards.slice(-drawingOpts.max)\n      const index = Math.min(cards.length - 1, Math.floor((point[prop] - drawingOpts.box[prop]) / drawingOpts.space))\n      if (stack.type !== StackType.waste || index === cards.length - 1)\n        dispatch(clickCard({ stack, stackCard: cards[index] }))\n    },\n    [dispatch, gameContext, drawingOpts, stack],\n  )\n\n  useDrawing((context) => drawStack(context, drawingOpts), { onClick, onDoubleClick })\n\n  return null\n}\n\nexport { StackElement }\nexport default React.memo(StackElement)\n","import { ValueType, SuitType, StackCard } from '../lib/Card'\nimport { Box, DrawingContext } from './Common'\nimport { isBig, isRed } from '../lib/util'\nimport { search, measureHeight } from './FontSize'\n\nimport { getCardDimensions, getVerticalMarginSize, getHorizontalMarginSize } from './Layout'\n\ntype Glyph = {\n  glyph: ValueType | SuitType\n  x: number\n  y: number\n  rotated: boolean\n  textAlign: CanvasTextAlign\n  textBaseline: CanvasTextBaseline\n  font: string\n}\n\nexport const getBoxPath = ({ x, y, width, height }: Box, radius = 10, smaller = 0) => {\n  const path = new Path2D()\n\n  const dx = x + smaller\n  const dy = y + smaller\n  const dw = width - smaller * 2\n  const dh = height - smaller * 2\n\n  path.moveTo(dx + radius, dy)\n  path.lineTo(dx + dw - radius, dy)\n  path.quadraticCurveTo(dx + dw, dy, dx + dw, dy + radius)\n  path.lineTo(dx + dw, dy + dh - radius)\n  path.quadraticCurveTo(dx + dw, dy + dh, dx + dw - radius, dy + dh)\n  path.lineTo(dx + radius, dy + dh)\n  path.quadraticCurveTo(dx, dy + dh, dx, dy + dh - radius)\n  path.lineTo(dx, dy + radius)\n  path.quadraticCurveTo(dx, dy, dx + radius, dy)\n  path.closePath()\n  return path\n}\n\nenum FontSizeType {\n  Regular,\n  Corner,\n}\n\nexport const getGlyphLocations = (context: DrawingContext, { card, hidden }: StackCard): Glyph[] => {\n  if (hidden) return []\n\n  const { ctx } = context\n  const { width: cardWidth, height: cardHeight } = getCardDimensions(context)\n  const gutterHeight = getVerticalMarginSize(context)\n  const gutterWidth = getHorizontalMarginSize(context)\n\n  const cornerWidth = Math.floor(cardWidth * 0.2)\n  const figureOutFontSize = (type: FontSizeType) =>\n    search(\n      ctx,\n      (width: number, height: number) =>\n        type === FontSizeType.Corner\n          ? width > cornerWidth\n          : isBig(card)\n          ? width > cardWidth - Math.floor(cardWidth / 5) * 2\n          : width > Math.floor(cardWidth / 5) && height > Math.floor(cardHeight / 20),\n      type === FontSizeType.Corner ? '10' : '\\u2665',\n    )\n\n  const fontSizes: { [key in FontSizeType]: string } = {\n    [FontSizeType.Corner]: figureOutFontSize(FontSizeType.Corner),\n    [FontSizeType.Regular]: figureOutFontSize(FontSizeType.Regular),\n  }\n\n  // 20% of width is reserved for corner pieces\n  // y of suit is margin + height of value + margin\n  const cornerHeight = measureHeight(ctx, fontSizes[FontSizeType.Corner])\n\n  const cornerValueX = gutterWidth / 2\n  const cornerValueY = gutterHeight / 2\n  const cornerSuitX = gutterWidth / 2\n  const cornerSuitY = gutterWidth / 2 + cornerHeight\n\n  const { suit, value } = card\n\n  // top-left, bottom-right glyphs\n  const positions = [\n    { x: cornerValueX, y: cornerValueY, glyph: value },\n    { x: cornerSuitX, y: cornerSuitY, glyph: suit },\n  ].reduce<Glyph[]>((memo, glyph) => {\n    memo.push(\n      {\n        ...glyph,\n        rotated: false,\n        textAlign: 'left',\n        textBaseline: 'top',\n        font: fontSizes[FontSizeType.Corner],\n      },\n      {\n        ...glyph,\n        rotated: true,\n        textAlign: 'left',\n        textBaseline: 'top',\n        font: fontSizes[FontSizeType.Corner],\n      },\n    )\n    return memo\n  }, [])\n\n  type ypos = 0 | 1 | 2 | 3 | 4 | 5 | 6\n\n  type xpos = 0 | 1 | 2\n\n  const pos: { x: xpos; y: ypos }[] = []\n\n  if (\n    [\n      ValueType.ace,\n      ValueType.three,\n      ValueType.five,\n      ValueType.nine,\n      ValueType.jack,\n      ValueType.queen,\n      ValueType.king,\n    ].includes(value)\n  ) {\n    pos.push({ x: 1, y: 3 })\n  }\n\n  if ([ValueType.two, ValueType.three].includes(value)) {\n    pos.push({ x: 1, y: 0 }, { x: 1, y: 6 })\n  }\n\n  if (\n    [\n      ValueType.four,\n      ValueType.five,\n      ValueType.six,\n      ValueType.seven,\n      ValueType.eight,\n      ValueType.nine,\n      ValueType.ten,\n    ].includes(value)\n  ) {\n    pos.push({ x: 0, y: 0 }, { x: 2, y: 0 }, { x: 0, y: 6 }, { x: 2, y: 6 })\n  }\n\n  if ([ValueType.six, ValueType.seven, ValueType.eight].includes(value)) {\n    pos.push({ x: 0, y: 3 }, { x: 2, y: 3 })\n  }\n\n  if ([ValueType.seven, ValueType.ten, ValueType.eight].includes(value)) {\n    pos.push({ x: 1, y: 1 })\n  }\n\n  if ([ValueType.nine, ValueType.ten].includes(value)) {\n    pos.push({ x: 0, y: 2 }, { x: 2, y: 2 }, { x: 0, y: 4 }, { x: 2, y: 4 })\n  }\n\n  if ([ValueType.ten, ValueType.eight].includes(value)) {\n    pos.push({ x: 1, y: 5 })\n  }\n\n  const getTop = (y: ypos) => {\n    switch (y) {\n      case 0:\n      case 6:\n        return cardHeight * 0.2\n      case 1:\n      case 5:\n        return cardHeight * 0.3\n      case 2:\n      case 4:\n        return cardHeight * 0.4\n      case 3:\n        return cardHeight * 0.5\n    }\n  }\n\n  const getLeft = (x: xpos) => {\n    switch (x) {\n      case 0:\n        return cardWidth * 0.25\n      case 1:\n        return cardWidth * 0.5\n      case 2:\n        return cardWidth * 0.75\n    }\n  }\n\n  const getTextAlign = (x: xpos): CanvasTextAlign => {\n    switch (x) {\n      case 0:\n        return 'left'\n      case 1:\n        return 'center'\n      case 2:\n        return 'right'\n    }\n  }\n\n  pos.forEach(({ x, y }) => {\n    positions.push({\n      x: getLeft(x),\n      y: getTop(y),\n      glyph: suit,\n      textAlign: getTextAlign(x),\n      textBaseline: 'middle',\n      rotated: y > 3,\n      font: fontSizes[FontSizeType.Regular],\n    })\n  })\n\n  return positions\n}\n\nexport const getEmptyImageData = (context: DrawingContext) => {\n  const { ctx, colorScheme } = context\n  const { width, height } = getCardDimensions(context)\n  const box = { x: 0, y: 0, width, height }\n  ctx.clearRect(0, 0, width, height)\n  ctx.fillStyle = colorScheme.emptyColor\n  ctx.fillRect(box.x, box.y, box.width, box.height)\n  ctx.lineWidth = 0.5\n  ctx.strokeStyle = colorScheme.cardBorder\n  ctx.strokeRect(box.x, box.y, box.width, box.height)\n  return ctx.getImageData(box.x, box.y, box.width, box.height)\n}\n\nexport const getHiddenImageData = (context: DrawingContext) => {\n  const { ctx, colorScheme } = context\n  const { width, height } = getCardDimensions(context)\n  const box = { x: 0, y: 0, width, height }\n\n  const tile = document.createElement('canvas')\n  const thickness = 25\n  tile.width = tile.height = thickness\n  const tileCtx = tile.getContext('2d') as CanvasRenderingContext2D\n  const gradient = tileCtx.createLinearGradient(0, 0, tile.width, tile.height)\n\n  gradient.addColorStop(0, colorScheme.hiddenColor1)\n  gradient.addColorStop(0.25, colorScheme.hiddenColor1)\n\n  gradient.addColorStop(0.25, colorScheme.hiddenColor2)\n  gradient.addColorStop(0.5, colorScheme.hiddenColor2)\n\n  gradient.addColorStop(0.5, colorScheme.hiddenColor1)\n  gradient.addColorStop(0.75, colorScheme.hiddenColor1)\n\n  gradient.addColorStop(0.75, colorScheme.hiddenColor2)\n  gradient.addColorStop(1, colorScheme.hiddenColor2)\n\n  tileCtx.fillStyle = gradient\n  tileCtx.fillRect(0, 0, thickness, thickness)\n\n  ctx.clearRect(box.x, box.y, box.width, box.height)\n  ctx.strokeStyle = colorScheme.cardBorder\n  ctx.lineWidth = 3\n  ctx.stroke(getBoxPath(box))\n  ctx.save()\n  ctx.clip(getBoxPath(box, 10))\n  ctx.fillStyle = ctx.createPattern(tile, 'repeat') as CanvasPattern\n  ctx.fillRect(box.x + 1, box.y + 1, box.width - 2, box.height - 2)\n  ctx.restore()\n\n  return ctx.getImageData(box.x, box.y, box.width, box.height)\n}\n\nexport const getCardImageData = (context: DrawingContext, card: StackCard) => {\n  const { ctx, colorScheme } = context\n  const { width, height } = getCardDimensions(context)\n  const box = { x: 0, y: 0, width, height }\n\n  ctx.clearRect(box.x, box.y, box.width, box.height)\n  ctx.strokeStyle = colorScheme.cardBorder\n  ctx.lineWidth = 2\n  ctx.stroke(getBoxPath(box, 10))\n\n  ctx.fillStyle = card.selected ? colorScheme.selected : colorScheme.faceUp\n  ctx.fill(getBoxPath(box, 10, 0.5))\n\n  for (const glyph of getGlyphLocations(context, card)) {\n    ctx.fillStyle = isRed(card.card) ? colorScheme.red : colorScheme.black\n    ctx.textAlign = glyph.textAlign\n    ctx.textBaseline = glyph.textBaseline\n    ctx.font = glyph.font\n    if (glyph.rotated) {\n      ctx.save()\n      ctx.translate(width, height)\n      ctx.rotate(Math.PI)\n    }\n    ctx.fillText(glyph.glyph, glyph.x + box.x * (glyph.rotated ? -1 : 1), glyph.y + box.y * (glyph.rotated ? -1 : 1))\n    if (glyph.rotated) ctx.restore()\n  }\n  return ctx.getImageData(box.x, box.y, box.width, box.height)\n}\n\nexport const getErrorImageData = (context: DrawingContext) => {\n  const { ctx, colorScheme } = context\n  const { width, height } = getCardDimensions(context)\n  const box = { x: 0, y: 0, width, height }\n  ctx.clearRect(box.x, box.y, box.width, box.height)\n  ctx.fillStyle = colorScheme.emptyColor\n  ctx.fill(getBoxPath(box))\n  ctx.font = '48px sans-serif'\n  ctx.textAlign = 'center'\n  ctx.textBaseline = 'middle'\n  ctx.fillStyle = colorScheme.errorColor\n  ctx.fillText('X', box.width / 2, box.height / 2)\n  return ctx.getImageData(box.x, box.y, box.width, box.height)\n}\n","// add variables to `style` declaration\ndeclare module 'csstype' {\n  interface Properties {\n    '--background'?: string\n    '--emptyColor'?: string\n    '--faceUp'?: string\n    '--hiddenColor1'?: string\n    '--hiddenColor2'?: string\n    '--buttonBorder'?: string\n    '--cardBorder'?: string\n    '--black'?: string\n    '--red'?: string\n    '--selected'?: string\n    '--errorColor'?: string\n    '--labelColor'?: string\n  }\n}\n\nexport enum ColorSchemeType {\n  dark = 'dark',\n  light = 'light',\n}\n\nexport type ColorScheme = {\n  background: string\n  hiddenColor1: string\n  hiddenColor2: string\n  buttonBorder: string\n  cardBorder: string\n  faceUp: string\n  selected: string\n  red: string\n  black: string\n  emptyColor: string\n  errorColor: string\n  color: string\n}\n\nexport const colorSchemes: { [key in ColorSchemeType]: ColorScheme } = {\n  [ColorSchemeType.dark]: {\n    background: '#000',\n    color: '#fff',\n    emptyColor: '#060606',\n    faceUp: '#ddd',\n    hiddenColor1: '#404dac',\n    hiddenColor2: '#263278',\n    buttonBorder: '#ddd',\n    cardBorder: '#000',\n    black: '#505050',\n    red: '#f03a17',\n    selected: '#fff000',\n    errorColor: '#900',\n  },\n  [ColorSchemeType.light]: {\n    background: '#ffffff',\n    color: '#000',\n    emptyColor: '#f5f5f5',\n    faceUp: '#ddd',\n    hiddenColor1: '#606dbc',\n    hiddenColor2: '#465298',\n    buttonBorder: '#000',\n    cardBorder: '#000',\n    black: '#505050',\n    red: '#f03a17',\n    selected: '#fff000',\n    errorColor: 'red',\n  },\n}\n","import { Cards, StackCard } from '../lib/Card'\nimport { ColorScheme, ColorSchemeType } from './ColorScheme'\nimport { getErrorImageData, getEmptyImageData, getHiddenImageData, getCardImageData } from './Card'\nimport { getCardDimensions } from './Layout'\n\n// this is passed to all drawing routines. it includes :\n// the color they should draw,\n// the ctx to draw it on, and\n// the width/height of the canvas.\n\nexport type DrawingContext = {\n  ctx: CanvasRenderingContext2D\n  colorScheme: ColorScheme\n  colorSchemeType: ColorSchemeType\n} & Dimensions\n\nexport type Dimensions = { width: number; height: number }\n\nexport type Point = { x: number; y: number }\n\nexport type Box = Dimensions & Point\n\n// something that is drawable includes an x/y coords and a height/width\n// once removed, clearRect is with these values to clean it from the canvas\n// also, the click/double click handlers will inspect if point is in their path.\n\nexport type Drawable = { path: Path2D; box: Box }\n\nexport interface Handler {\n  (arg0: Drawable, arg1: Point): void\n}\n\nexport type Clickable = { onClick?: Handler; onDoubleClick?: Handler }\n\n// a cache of cards is kept and re-initialized when color scheme / window dimensions change\n// this is a map of a key identifying the stack card, and the raw pixel data to draw it.\n// the idea is this is all cached one time at the beginning and re-used\n\n// this uses a string with keys because it's actually a \"StackCard\" we're interested in\n// this includes the selected flag - the highlighted / non-highlighted state need to both be kept\n// while `Cards` is immutable singleton of all available cads, StackCards is not and\n// using a non-string key, we'll wind up with missing references not hitting the cache.\n\nexport const getKey = ({ card: { suit, value }, selected }: StackCard) =>\n  `${suit}_${value}_${(selected || false).toString()}`\n\nexport const cardCache: Map<string, ImageData> = new Map()\n\nlet c2: HTMLCanvasElement\n\nexport const initialize = (context: DrawingContext) => {\n  const { width, height } = getCardDimensions(context)\n  cardCache.set('hidden', getHiddenImageData(context))\n  cardCache.set('empty', getEmptyImageData(context))\n  cardCache.set('error', getErrorImageData(context))\n  Cards.forEach((card) => {\n    cardCache\n      .set(getKey({ card, selected: true }), getCardImageData(context, { card, selected: true }))\n      .set(getKey({ card, selected: false }), getCardImageData(context, { card, selected: false }))\n  })\n\n  c2 = document.createElement('canvas')\n  c2.width = width\n  c2.height = height\n  context.ctx.clearRect(0, 0, width + 2, height + 2)\n}\n\n// to get transarency working, (maybe other composition?) need an intermediary canvas to proxy the drawing.\n\nexport const writeDataToCanvas = (context: DrawingContext, data: ImageData, x: number, y: number) => {\n  const ctx2 = c2.getContext('2d')\n  ctx2?.putImageData(data, 0, 0)\n  context.ctx.drawImage(c2, x, y)\n}\n","const allFontSizes = Array.from<number, number>({ length: 200 }, (v, k) => k)\n\ninterface isBigEnough {\n  (width: number, height: number): boolean\n}\n\nexport const measureWidth = (ctx: CanvasRenderingContext2D, font: string, text: string) => {\n  ctx.font = font\n  return ctx.measureText(text).width\n}\n\nexport const measureHeight = (ctx: CanvasRenderingContext2D, font: string) => {\n  ctx.font = font\n  return ctx.measureText('M').width // close enough\n}\n\nconst searchFontSize = (\n  ctx: CanvasRenderingContext2D,\n  isBigEnough: isBigEnough,\n  text: string,\n  min: number,\n  max: number,\n): string => {\n  const index = Math.floor((max + min) / 2)\n  const font = `${allFontSizes[index]}px sans-serif`\n  const width = measureWidth(ctx, font, text)\n  const height = measureHeight(ctx, font)\n  if (min > max) return font\n  if (isBigEnough(width, height)) return searchFontSize(ctx, isBigEnough, text, min, index - 1)\n  return searchFontSize(ctx, isBigEnough, text, index + 1, max)\n}\n\nexport const search = (ctx: CanvasRenderingContext2D, isBigEnough: isBigEnough, text: string) =>\n  searchFontSize(ctx, isBigEnough, text, 0, allFontSizes.length - 1)\n","import { DrawingContext, Box, Dimensions } from './Common'\nimport { Stack, StackDirection, StackType } from '../lib/Card'\n\nexport const getStackCardOffsetWidth = (ctx: DrawingContext) => Math.floor(ctx.height * 0.03)\n\nexport const getStackCardOffsetHeight = (ctx: DrawingContext) => Math.floor(ctx.height * 0.03)\n\nexport const getVerticalMarginSize = (ctx: DrawingContext) => Math.floor(ctx.height * 0.01)\n\nexport const getHorizontalMarginSize = (ctx: DrawingContext) => Math.floor(ctx.width * 0.01)\n\nexport const getTopbarBox = (): Box => ({ x: 0, y: 0, width: 0, height: 30 })\n\n// the goal is to find the highest possible card width/height satisfying the desired ratio\n// assuming a fixed top-bar height with no margin, ( it will account for its own padding )\n// and 1 vertical separator + 6 horizontal separators\n// also, need room to stack 13 stack + 6 hidden => 19 cards.\n// without exceeding the size of the window.\n\nexport const getCardDimensions = (ctx: DrawingContext): Dimensions => {\n  const horizontalMargin = getHorizontalMarginSize(ctx)\n  const verticalMargin = getVerticalMarginSize(ctx)\n  const topBarBox = getTopbarBox()\n  const stackCardOffsetHeight = getStackCardOffsetHeight(ctx)\n\n  const usedVerticalSpace = topBarBox.height + verticalMargin * 2 + stackCardOffsetHeight * 19\n  const usedHorizontalSpace = horizontalMargin * 6\n\n  const maxWidth = Math.floor((ctx.width - usedHorizontalSpace) / 7)\n  const maxHeight = Math.floor((ctx.height - usedVerticalSpace) / 1.5)\n\n  const DESIRED_RATIO = 1.618 // try to get golden ratio size cards\n  const width = maxWidth * DESIRED_RATIO < maxHeight ? maxWidth : maxHeight / DESIRED_RATIO\n  const height = maxWidth * DESIRED_RATIO < maxHeight ? maxWidth * DESIRED_RATIO : maxHeight\n\n  return {\n    width: Math.floor(width),\n    height: Math.floor(height),\n  }\n}\n\nexport const getStackBox = (ctx: DrawingContext, stack: Stack, max: number): Box => {\n  const verticalMargin = getVerticalMarginSize(ctx)\n  const horizontalMargin = getHorizontalMarginSize(ctx)\n  const topBar = getTopbarBox()\n  const { width, height } = getCardDimensions(ctx)\n  const cardLength = Math.min(stack.cards.length, max)\n\n  // we know horizontal space used\n  // it might be less than available width\n  // base x width is half that available space (for centering)\n\n  const usedWidth = horizontalMargin * 6 + width * 7\n  const baseX = usedWidth < ctx.width ? (ctx.width - usedWidth) / 2 : 0\n\n  const stackWidth =\n    stack.direction === StackDirection.horizontal\n      ? cardLength === 0\n        ? height\n        : getStackCardOffsetWidth(ctx) * (cardLength - 1) + width\n      : width\n\n  const stackHeight =\n    stack.direction === StackDirection.vertical\n      ? cardLength === 0\n        ? height\n        : getStackCardOffsetHeight(ctx) * (cardLength - 1) + height\n      : height\n\n  switch (stack.type) {\n    case StackType.stock:\n      return {\n        y: topBar.height + verticalMargin,\n        x: baseX,\n        width: stackWidth,\n        height: stackHeight,\n      }\n    case StackType.waste:\n      return {\n        y: topBar.height + verticalMargin,\n        x: baseX + horizontalMargin + width,\n        width: stackWidth,\n        height: stackHeight,\n      }\n    case StackType.foundation:\n      return {\n        y: topBar.height + verticalMargin,\n        x: baseX + 3 * horizontalMargin + 3 * width + stack.index * (horizontalMargin + width),\n        width: stackWidth,\n        height: stackHeight,\n      }\n    case StackType.tableau:\n      return {\n        y: topBar.height + verticalMargin * 3 + height,\n        x: baseX + stack.index * (horizontalMargin + width),\n        width: stackWidth,\n        height: stackHeight,\n      }\n  }\n}\n","import { Stack, StackDirection, StackType } from '../lib/Card'\nimport { writeDataToCanvas, cardCache, getKey, DrawingContext, Box } from './Common'\nimport { getStackCardOffsetWidth, getStackCardOffsetHeight, getStackBox } from './Layout'\n\nexport type StackDrawingOptions = {\n  overDrawn: boolean\n  showing: number\n}\n\nexport type StackDrawingContext = StackDrawingOptions & {\n  stack: Stack\n  space: number\n  max: number\n  box: Box\n}\n\nexport const getStackDrawingContext = (\n  context: DrawingContext,\n  stack: Stack,\n  opts: StackDrawingOptions,\n): StackDrawingContext => {\n  const max =\n    stack.type === StackType.stock || stack.type === StackType.foundation\n      ? 1\n      : stack.type === StackType.waste\n      ? opts.showing || 0\n      : stack.cards.length\n\n  const box = getStackBox(context, stack, max)\n\n  const space =\n    stack.direction === StackDirection.horizontal ? getStackCardOffsetWidth(context) : getStackCardOffsetHeight(context)\n\n  return {\n    stack,\n    overDrawn: opts.overDrawn,\n    showing: opts.showing,\n    space,\n    box,\n    max,\n  }\n}\n\nexport const drawStack = (context: DrawingContext, drawingOpts: StackDrawingContext | null) => {\n  if (drawingOpts == null) return null\n  const { stack, overDrawn, max, space, box } = drawingOpts\n  const cards = stack.cards.slice(-max)\n\n  const path = new Path2D()\n  path.rect(box.x, box.y, box.width, box.height)\n  path.closePath()\n\n  const empty = cards.length === 0\n  const error = stack.type === StackType.stock && empty && overDrawn\n  const elements = []\n\n  if (error) elements.push({ data: cardCache.get('error'), x: box.x, y: box.y })\n  else if (empty) elements.push({ data: cardCache.get('empty'), x: box.x, y: box.y })\n  else\n    cards.forEach((card, i) => {\n      const drawing = card.hidden ? cardCache.get('hidden') : cardCache.get(getKey(card))\n      if (drawing) {\n        const x = stack.direction === StackDirection.horizontal ? i * space : 0\n        const y = stack.direction === StackDirection.horizontal ? 0 : i * space\n        elements.push({ data: drawing, x: box.x + x, y: box.y + y })\n      }\n    })\n\n  for (const { data, x, y } of elements) data && writeDataToCanvas(context, data, x, y)\n  return { path, box }\n}\n","import * as React from 'react'\nimport { Dimensions } from '../drawing/Common'\n\ntype CanvasSizeReturn = {\n  ctx?: CanvasRenderingContext2D\n  width?: number\n  height?: number\n  handleCanvasRef: (canvas: HTMLCanvasElement) => void\n}\n\nexport const useCanvasSize = (): CanvasSizeReturn => {\n  const [canvas, setCanvas] = React.useState<HTMLCanvasElement | null>(null)\n  const handleCanvasRef = React.useCallback((canvas: HTMLCanvasElement) => canvas && setCanvas(canvas), [])\n\n  const getSize = () => ({ width: window.innerWidth, height: window.innerHeight })\n\n  const [size, setSize] = React.useState<Dimensions>()\n\n  React.useEffect(() => {\n    let tid: number\n    const handleSize = () => {\n      if (tid) clearTimeout(tid)\n      tid = window.setTimeout(() => setSize(getSize()), 300)\n    }\n    window.addEventListener('resize', handleSize)\n    return () => {\n      window.removeEventListener('resize', handleSize)\n    }\n  })\n\n  const retVal = React.useMemo(\n    () => ({\n      handleCanvasRef,\n      ...(canvas && {\n        ctx: canvas.getContext('2d') as CanvasRenderingContext2D,\n        ...(size ?? getSize()),\n      }),\n    }),\n    [size, handleCanvasRef, canvas],\n  )\n\n  return retVal\n}\n","import * as React from 'react'\nimport { GameCtx } from '../components/GameCanvas'\nimport { Clickable, DrawingContext, Drawable } from '../drawing/Common'\n\nexport interface Drawer {\n  (context: DrawingContext): Drawable | null\n}\n\nexport const useDrawing = (draw: Drawer, events: Clickable = {}) => {\n  const gameContext = React.useContext(GameCtx)\n  const performCleanup = React.useRef(true)\n  const lastWidth = React.useRef(gameContext?.context.width ?? 0)\n  const lastHeight = React.useRef(gameContext?.context.height ?? 0)\n\n  // should only clear the rects if we haven't just resized the screen\n  // a screen resize will already clear the entire canvas\n  // if this isn't tracked, we end up drawing a new game and clear out the old sizes, leaving blank holes.\n\n  React.useLayoutEffect(() => {\n    if (!gameContext) return\n    performCleanup.current = !(\n      (lastHeight.current !== gameContext.context.height || lastWidth.current !== gameContext.context.width) &&\n      lastHeight.current > 0 &&\n      lastWidth.current > 0\n    )\n    lastHeight.current = gameContext.context.height\n    lastWidth.current = gameContext.context.width\n  }, [gameContext])\n\n  React.useEffect(() => {\n    if (gameContext == null) return\n    const { add, remove, context } = gameContext\n    const { ctx } = context\n\n    const thing = draw(context)\n    if (thing == null) return\n    add(thing, events)\n\n    return () => {\n      remove(thing.path)\n      if (performCleanup.current) {\n        ctx.clearRect(thing.box.x, thing.box.y, thing.box.width, thing.box.height)\n      }\n      performCleanup.current = true\n    }\n  })\n}\n","import * as React from 'react'\nimport * as ReactDOM from 'react-dom'\nimport * as offline from '@lcdp/offline-plugin/runtime'\n\nimport App from './components/App'\n\nconst NODE_ENV = process.env.NODE_ENV\nif (NODE_ENV === 'production') {\n  offline.install({\n    onUpdateReady() {\n      offline.applyUpdate()\n    },\n    onUpdated() {\n      window.location.reload()\n    },\n  })\n}\n\nReactDOM.render(<App />, document.getElementById('root'))\n","export enum ValueType {\n  ace = 'A',\n  two = '2',\n  three = '3',\n  four = '4',\n  five = '5',\n  six = '6',\n  seven = '7',\n  eight = '8',\n  nine = '9',\n  ten = '10',\n  jack = 'J',\n  queen = 'Q',\n  king = 'K',\n}\n\nexport enum SuitType {\n  heart = '\\u2665',\n  diamond = '\\u2666',\n  spade = '\\u2660',\n  club = '\\u2663',\n}\n\nexport type Card = {\n  suit: SuitType\n  value: ValueType\n}\n\nexport type StackCard = {\n  card: Card\n  hidden?: boolean\n  selected?: boolean\n}\n\nexport enum StackDirection {\n  horizontal = 'horizontal',\n  vertical = 'vertical',\n}\n\n//\n//  1 2   3 3 3 3\n//  4 4 4 4 4 4 4\n//\n// 1 - stock\n// 2 - waste\n// 3 - foundation\n// 4 - tableau\n//\n\nexport enum StackType {\n  tableau = 'tableau',\n  foundation = 'foundation',\n  stock = 'stock',\n  waste = 'waste',\n}\n\nexport type Stack = {\n  cards: StackCard[]\n  selection: StackCard | null\n  type: StackType\n  direction: StackDirection | null\n  index: number\n}\n\nconst Cards: Card[] = []\n\nfor (const value of Object.values(ValueType)) {\n  for (const suit of Object.values(SuitType)) {\n    Cards.push({ suit, value })\n  }\n}\n\nObject.freeze(Cards)\n\nexport { Cards }\n","export enum PersistanceType {\n  type = 'game-mode',\n  theme = 'theme',\n  score = 'score',\n  number = 'game-number',\n}\n\nexport const persist: <T>(name: PersistanceType, thing: T) => void = (name, thing) => {\n  try {\n    localStorage.setItem(name, JSON.stringify(thing))\n  } catch (err) {\n    // that sucks\n  }\n}\n\nexport const retrieve = <T>(name: PersistanceType, init: T) => {\n  try {\n    const thing = localStorage.getItem(name) || ''\n    return JSON.parse(thing) as T\n  } catch (err) {\n    return init\n  }\n}\n","export enum ScoringType {\n  vegas = 'vegas',\n  regular = 'regular',\n}\n\nexport enum ScoreType {\n  wasteToTableau = 'wasteToTableau',\n  wasteToFoundation = 'wasteToFoundation',\n  tableauToFoundation = 'tableauToFoundation',\n  revealCard = 'revealCard',\n  foundationToTableau = 'foundationToTableau',\n}\n\nexport const getScoreChange = (scoringType: ScoringType, scoreType: ScoreType) => {\n  let score = 0\n  if (scoringType === ScoringType.regular && scoreType === ScoreType.tableauToFoundation) {\n    score = 10\n  } else if (\n    scoreType === ScoreType.wasteToFoundation ||\n    (scoringType === ScoringType.vegas && scoreType === ScoreType.tableauToFoundation) ||\n    (scoringType === ScoringType.regular && scoreType === ScoreType.revealCard) ||\n    (scoringType === ScoringType.regular && scoreType === ScoreType.wasteToTableau)\n  ) {\n    score = 5\n  } else if (scoringType === ScoringType.regular && ScoreType.foundationToTableau) {\n    score = -10\n  } else if (scoringType === ScoringType.vegas && scoreType === ScoreType.foundationToTableau) {\n    score = -5\n  }\n  return score\n}\n","import { Card, ValueType, SuitType, Stack, StackCard } from './Card'\n\n// minstd_rand\nexport const rnd = (s: number) => {\n  const rnd = () => ((2 ** 31 - 1) & (s = Math.imul(48271, s))) / 2 ** 31\n  rnd() // first call is always junk\n  return (min: number, max: number) => Math.floor(rnd() * max) + min\n}\n\nexport const sumConsecutive = (i: number) => (i * (i + 1)) / 2\n\nexport const getTopCard = (stack: Stack): StackCard | null => stack.cards[stack.cards.length - 1] || null\n\nconst random = (min: number, max: number) => Math.floor(Math.random() * max) + min\n\nexport const newGameNumber = () => random(1, 9999)\n\n// for simplicity, these routines would just use strict object comparison\n// however, if doing that, any changes to the store in a thunk would invalidate variable reference\n// this is useful for comparing a selected, or checking if stacks are the same before modifying them\n// so, we compare both value/suit when doing card comparisons, and type/index for stack comparisons\n\nexport const sameStack = (src: Stack, dest: Stack) => src.type === dest.type && src.index === dest.index\n\nconst sameSuit = (src: Card, dest: Card) => src.suit === dest.suit\n\nconst sameValue = (src: Card, dest: Card) => src.value === dest.value\n\nexport const sameCard = (src: Card, dest: Card) => sameValue(src, dest) && sameSuit(src, dest)\n\nexport const contains = (cards: StackCard[], dest: Card): boolean => cards.some(({ card: src }) => sameCard(src, dest))\n\nconst sequential = (src: Card, dest: Card) => valueToInt(src.value) === valueToInt(dest.value) + 1\n\nexport const isRed = (card: Card) => [SuitType.diamond, SuitType.heart].includes(card.suit)\n\nconst different = (src: Card, dest: Card) => +isRed(src) ^ +isRed(dest)\n\nexport const isBig = (card: Card) =>\n  [ValueType.ace, ValueType.jack, ValueType.queen, ValueType.king].includes(card.value)\n\nexport const isValidFoundationMove = (src: StackCard, dest: StackCard | null) =>\n  dest == null ? src.card.value === ValueType.ace : sameSuit(src.card, dest.card) && sequential(src.card, dest.card)\n\nexport const isValidTableauMove = (src: StackCard, dest: StackCard | null) =>\n  dest == null ? src.card.value === ValueType.king : sequential(dest.card, src.card) && different(src.card, dest.card)\n\nconst valueToInt = (value: ValueType): number => {\n  if (value === ValueType.ace) return 1\n  if (value === ValueType.jack) return 11\n  if (value === ValueType.queen) return 12\n  if (value === ValueType.king) return 13\n  return parseInt(value, 10)\n}\n","import { createSlice, PayloadAction, AnyAction } from '@reduxjs/toolkit'\nimport { StackType } from '../lib/Card'\nimport { retrieve, PersistanceType } from '../lib/Persist'\nimport { ScoringType, getScoreChange, ScoreType } from '../lib/Scoring'\nimport { ColorSchemeType } from '../drawing/ColorScheme'\nimport { initialize } from './init'\nimport { undoable } from './undoable'\nimport { MoveCardPayload, shiftCards } from './stacks'\n\nconst gameStateSlice = createSlice({\n  name: 'game-state',\n  initialState: {\n    draws: 0,\n    number: 0,\n    score: 0,\n    scoringType: ScoringType.regular,\n    showing: 0,\n    theme: ColorSchemeType.dark,\n  },\n  reducers: {\n    incrementDraws(state) {\n      state.draws = state.draws + 1\n    },\n    incrementScore(state, { payload }: PayloadAction<ScoreType>) {\n      state.score = state.score + getScoreChange(state.scoringType, payload)\n    },\n    changeTheme(state, { payload }: PayloadAction<ColorSchemeType>) {\n      state.theme = payload\n    },\n  },\n  extraReducers: (builder) =>\n    builder\n      .addCase(initialize, (state, { payload }) => {\n        state.draws = 0\n        state.number = payload.number\n        state.score = payload.scoringType === ScoringType.vegas ? retrieve(PersistanceType.score, 0) - 52 : 0\n        state.scoringType = payload.scoringType\n        state.showing = 3\n        state.theme = payload.theme\n      })\n      .addMatcher(\n        (action: AnyAction): action is PayloadAction<MoveCardPayload> =>\n          shiftCards.match(action) &&\n          (action.payload.to.type === StackType.waste ||\n            (action.payload.from && action.payload.from.type === StackType.waste)),\n        (state, { payload: { to, cards } }) => {\n          state.showing =\n            to.type === StackType.waste ? Math.min(to.cards.length + cards.length, 3) : Math.max(1, state.showing - 1)\n        },\n      ),\n})\n\nexport const { incrementDraws, incrementScore, changeTheme } = gameStateSlice.actions\n\nexport default undoable(gameStateSlice.reducer)\n","import { configureStore, combineReducers, ThunkAction, Action, getDefaultMiddleware } from '@reduxjs/toolkit'\nimport { createLogger } from 'redux-logger'\nimport subscribe from 'redux-subscribe-reselect'\n\nimport { getType, getGameState, getTheme, getNumber } from './selectors'\nimport stacks from './stacks'\nimport gameState from './game-state'\nimport { persist, PersistanceType } from '../lib/Persist'\nimport { StackCard, Stack } from '../lib/Card'\nimport { ScoringType } from '../lib/Scoring'\n\nconst middleware = getDefaultMiddleware({ immutableCheck: false, serializableCheck: false })\n\nif (process.env.NODE_ENV !== 'production') {\n  middleware.push(\n    createLogger({\n      stateTransformer: (state: StoreState) => ({\n        gameState: state.gameState.present,\n        stacks: state.stacks.present,\n      }),\n    }),\n  )\n}\n\nconst reducer = combineReducers({ stacks, gameState })\nconst store = configureStore({ reducer, middleware })\n\nsubscribe(store, getGameState, ({ scoringType, score }) => {\n  if (scoringType === ScoringType.vegas) persist(PersistanceType.score, score)\n})\nsubscribe(store, getType, (scoringType) => persist(PersistanceType.type, scoringType))\nsubscribe(store, getTheme, (newTheme) => persist(PersistanceType.theme, newTheme))\nsubscribe(store, getNumber, (number) => persist(PersistanceType.number, number))\n\nexport type StoreState = ReturnType<typeof reducer>\n\nexport type AppDispatch = typeof store.dispatch\nexport type AppThunk<T = void> = ThunkAction<T, StoreState, unknown, Action>\n\nexport type CardSelection = { stackCard: StackCard | null; stack: Stack }\n\nexport default store\n","import { createAction } from '@reduxjs/toolkit'\n\nimport { Card } from '../lib/Card'\nimport { ScoringType } from '../lib/Scoring'\nimport { ColorSchemeType } from '../drawing/ColorScheme'\n\n// this is in it's own file because circular dependencies are jerks.\n\nexport const initialize =\n  createAction<{\n    scoringType: ScoringType\n    cards: Card[]\n    number: number\n    theme: ColorSchemeType\n  }>('initialize')\n","import { createSelector } from 'reselect'\nimport { StackType, StackCard } from '../lib/Card'\nimport { getTopCard, isValidFoundationMove } from '../lib/util'\nimport { ScoringType } from '../lib/Scoring'\nimport { StoreState, CardSelection } from './index'\n\nexport const getStacks = createSelector(\n  (state: StoreState) => state.stacks.present.stacks,\n  (stacks) => stacks,\n)\n\nconst getFoundation = createSelector(getStacks, (stacks) =>\n  stacks.filter((stack) => stack.type === StackType.foundation),\n)\n\nexport const getTableau = createSelector(getStacks, (stacks) =>\n  stacks.filter((stack) => stack.type === StackType.tableau),\n)\n\nexport const getGameWon = createSelector(getFoundation, (foundation) =>\n  foundation.every((stack) => stack.cards.length === 13),\n)\n\nexport const getHiddenCard = createSelector(getTableau, (stacks) =>\n  stacks.reduce<CardSelection | null>((acc, stack) => {\n    if (acc) return acc\n    const topCard = getTopCard(stack)\n    if (topCard && topCard.hidden) return { stack, stackCard: topCard }\n    return null\n  }, null),\n)\n\nexport const getMovableToFoundation = createSelector([getStacks, getFoundation], (stacks, foundation) =>\n  stacks\n    .filter((stack) => stack.type !== StackType.foundation)\n    .reduce<CardSelection | null>((acc, stack) => {\n      if (acc) return acc\n      const topCard = getTopCard(stack)\n      if (topCard == null || topCard.hidden) return acc\n      if (foundation.some((f) => isValidFoundationMove(topCard, getTopCard(f)))) return { stack, stackCard: topCard }\n      return null\n    }, null),\n)\n\nexport const getStock = createSelector(\n  getStacks,\n  (stacks) => stacks.filter((stack) => stack.type === StackType.stock)[0],\n)\n\nexport const getWaste = createSelector(\n  getStacks,\n  (stacks) => stacks.filter((stack) => stack.type === StackType.waste)[0],\n)\n\nexport const getFoundationStack = createSelector(\n  getFoundation,\n  (_: unknown, stackCard: StackCard) => stackCard,\n  (foundation, stackCard) => foundation.find((stack) => isValidFoundationMove(stackCard, getTopCard(stack))),\n)\n\nexport const getGameState = createSelector(\n  (state: StoreState) => state.gameState.present,\n  (score) => score,\n)\n\nexport const getTheme = createSelector(getGameState, (gameState) => gameState.theme)\n\nexport const getScore = createSelector(getGameState, (gameState) => gameState.score)\n\nexport const getType = createSelector(getGameState, (gameState) => gameState.scoringType)\n\nexport const getDraws = createSelector(getGameState, (gameState) => gameState.draws)\n\nconst VEGAS_DRAW_LIMIT = 3\nexport const getOverDrawn = createSelector(\n  [getDraws, getType],\n  (draws, scoringType) => scoringType === ScoringType.vegas && draws + 1 > VEGAS_DRAW_LIMIT,\n)\n\nexport const getShowing = createSelector(getGameState, ({ showing }) => showing)\n\nexport const getNumber = createSelector(getGameState, ({ number }) => number)\n\nexport const getSelection = createSelector(getStacks, (stacks) => {\n  const stack = stacks.find((stack) => stack.selection != null)\n  if (stack) return { stackCard: stack.selection, stack: stack }\n  return null\n})\n\nexport const disallowClickStock = createSelector(\n  [getStock, getOverDrawn],\n  (stock, overDrawn) => stock.cards.length === 0 && overDrawn,\n)\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit'\n\nimport { Stack, StackCard, StackType, StackDirection } from '../lib/Card'\nimport { contains, sumConsecutive, sameStack, sameCard } from '../lib/util'\nimport { undoable } from './undoable'\nimport { initialize } from './init'\n\nexport type MoveCardPayload = { from: Stack; to: Stack; cards: StackCard[]; hidden: boolean }\n\nconst stacksSlice = createSlice({\n  name: 'stacks',\n  initialState: {\n    stacks: [\n      {\n        type: StackType.stock,\n        direction: null,\n        cards: [],\n        index: 0,\n        selection: null,\n      },\n      {\n        type: StackType.waste,\n        direction: StackDirection.horizontal,\n        cards: [],\n        index: 0,\n        selection: null,\n      },\n      ...Array.from<number, Stack>({ length: 7 }, (_, index) => ({\n        type: StackType.tableau,\n        direction: StackDirection.vertical,\n        cards: [],\n        index,\n        selection: null,\n      })),\n      ...Array.from<number, Stack>({ length: 4 }, (_, index) => ({\n        type: StackType.foundation,\n        direction: null,\n        cards: [],\n        index,\n        selection: null,\n      })),\n    ],\n  },\n  reducers: {\n    shiftCards: (state, { payload: { from, to, cards, hidden } }: PayloadAction<MoveCardPayload>) => {\n      const toStack = state.stacks.find((stack) => sameStack(to, stack))\n      const fromStack = state.stacks.find((stack) => sameStack(from, stack))\n      if (toStack) toStack.cards.push(...cards.map((card) => ({ ...card, selected: false, hidden })))\n      if (fromStack) fromStack.cards = fromStack.cards.filter((stackCard) => !contains(cards, stackCard.card))\n    },\n    revealTop: (state, { payload }: PayloadAction<Stack>) => {\n      const thisStack = state.stacks.find((stack) => sameStack(stack, payload))\n      if (thisStack) {\n        const topCard = thisStack.cards[thisStack.cards.length - 1]\n        if (topCard) topCard.hidden = false\n      }\n    },\n    selectCard: (state, { payload: { stack, stackCard } }: PayloadAction<{ stack: Stack; stackCard: StackCard }>) => {\n      const thisStack = state.stacks.find((src) => sameStack(src, stack))\n      if (thisStack) {\n        thisStack.selection = stackCard\n        const thisCard = thisStack.cards.find((src) => sameCard(src.card, stackCard.card))\n        if (thisCard) thisCard.selected = true\n      }\n    },\n    deselectCard: (state) => {\n      const thisStack = state.stacks.find((stack) => stack.selection != null)\n      if (thisStack) {\n        thisStack.selection = null\n        const selectedCard = thisStack.cards.find((stackCard) => stackCard.selected)\n        if (selectedCard) selectedCard.selected = false\n      }\n    },\n  },\n  extraReducers: (builder) =>\n    builder.addCase(initialize, (state, { payload }) => {\n      state.stacks = state.stacks.map((stack) => {\n        switch (stack.type) {\n          case StackType.foundation:\n          case StackType.waste:\n            return { ...stack, cards: [] }\n          case StackType.stock:\n            return { ...stack, cards: payload.cards.slice(0, 24).map((card) => ({ card, hidden: true })) }\n          case StackType.tableau:\n            return {\n              ...stack,\n              cards: payload.cards\n                .slice(24 + sumConsecutive(stack.index), 24 + sumConsecutive(stack.index) + stack.index + 1)\n                .map((card, index, a) => ({ card, hidden: a.length !== index + 1 })),\n            }\n        }\n      })\n    }),\n})\n\nexport const { selectCard, deselectCard, revealTop, shiftCards } = stacksSlice.actions\n\nexport const moveCards = (from: Stack, to: Stack, from_card: StackCard | null) =>\n  shiftCards({\n    from,\n    to,\n    cards: from.cards.slice(from.cards.findIndex((card) => from_card && sameCard(card.card, from_card.card))),\n    hidden: false,\n  })\n\nexport const drawStockCards = ({ stock, waste }: { stock: Stack; waste: Stack }) =>\n  shiftCards({ from: stock, to: waste, cards: stock.cards.slice(-3).reverse(), hidden: false })\n\nexport const recycleWaste = ({ stock, waste }: { stock: Stack; waste: Stack }) =>\n  shiftCards({ from: waste, to: stock, cards: waste.cards.slice(0).reverse(), hidden: true })\n\nexport default undoable(stacksSlice.reducer)\n","import { AppThunk, CardSelection } from '.'\nimport { isValidTableauMove, newGameNumber, rnd } from '../lib/util'\nimport { StackType, Card, Cards } from '../lib/Card'\nimport { ScoringType, ScoreType } from '../lib/Scoring'\nimport { ColorSchemeType } from '../drawing/ColorScheme'\n\nimport { initialize } from './init'\nimport { moveCards, deselectCard, selectCard, revealTop, drawStockCards, recycleWaste } from './stacks'\nimport {\n  getSelection,\n  getFoundationStack,\n  disallowClickStock,\n  getWaste,\n  getStock,\n  getType,\n  getMovableToFoundation,\n  getHiddenCard,\n  getNumber,\n  getTheme,\n} from './selectors'\nimport { checkpoint } from './undoable'\nimport { incrementScore, incrementDraws } from './game-state'\n\nexport const newType = (newType?: ScoringType) => initializeGame({ newNumber: newGameNumber(), newType })\n\nexport const newNumber = (newNumber?: number) =>\n  initializeGame({ newNumber: newNumber == null ? newGameNumber() : newNumber })\n\ntype InitOptions = { newType?: ScoringType; newNumber?: number; newTheme?: ColorSchemeType }\n\nexport const initializeGame =\n  ({ newType, newNumber, newTheme }: InitOptions): AppThunk =>\n  (dispatch, getState) => {\n    const number = newNumber == null ? getNumber(getState()) : newNumber\n    const scoringType = newType == null ? getType(getState()) : newType\n    const theme = newTheme == null ? getTheme(getState()) : newTheme\n\n    const availableCards = Array.from(Cards)\n    const cards: Card[] = []\n\n    const rando = rnd(number)\n\n    for (let i = 0; i < 52; i += 1) {\n      const index = rando(0, availableCards.length)\n      const [card] = availableCards.splice(index, 1)\n      cards.push(card)\n    }\n\n    dispatch(initialize({ scoringType, cards, number, theme }))\n  }\n\nexport const performMoves = (): AppThunk => (dispatch, getState) => {\n  let movable: CardSelection | null\n  while ((movable = getMovableToFoundation(getState()) || getHiddenCard(getState()))) {\n    if (movable.stackCard?.hidden ?? false) {\n      dispatch(checkAndPerformCardReveal(movable))\n    } else {\n      dispatch(checkAndPerformFoundationMove(movable))\n    }\n  }\n}\n\nconst checkAndPerformCardReveal =\n  (selection: CardSelection): AppThunk =>\n  (dispatch) => {\n    if (selection == null) return\n    dispatch(checkpoint())\n    dispatch(incrementScore(ScoreType.revealCard))\n    dispatch(revealTop(selection.stack))\n  }\n\nconst checkAndPerformFoundationMove =\n  (selection: CardSelection): AppThunk =>\n  (dispatch, getState) => {\n    const foundation = selection.stackCard && getFoundationStack(getState(), selection.stackCard)\n    if (foundation && selection.stackCard) {\n      dispatch(deselectCard())\n      dispatch(checkpoint())\n      if (selection.stack.type === StackType.waste) dispatch(incrementScore(ScoreType.wasteToFoundation))\n      if (selection.stack.type === StackType.tableau) dispatch(incrementScore(ScoreType.tableauToFoundation))\n      dispatch(moveCards(selection.stack, foundation, selection.stackCard))\n    }\n  }\n\nexport const clickCard =\n  (cardSelection: CardSelection): AppThunk =>\n  (dispatch, getState) => {\n    const { stackCard, stack } = cardSelection\n    if (stackCard != null && stackCard.selected) return dispatch(deselectCard())\n\n    const selection = getSelection(getState())\n    if (selection == null && stackCard && !stackCard.hidden) return dispatch(selectCard({ stack, stackCard }))\n\n    if (stack.type === StackType.foundation && selection) {\n      dispatch(checkAndPerformFoundationMove(selection))\n      return\n    }\n\n    if (stack.type === StackType.tableau) {\n      if (selection == null && stackCard && stackCard.hidden) {\n        dispatch(checkpoint())\n        dispatch(incrementScore(ScoreType.revealCard))\n        dispatch(revealTop(stack))\n      }\n      if (selection && selection.stackCard && isValidTableauMove(selection.stackCard, stackCard)) {\n        dispatch(deselectCard())\n        dispatch(checkpoint())\n        if (selection.stack.type === StackType.waste) dispatch(incrementScore(ScoreType.wasteToTableau))\n        if (selection.stack.type === StackType.foundation) dispatch(incrementScore(ScoreType.foundationToTableau))\n        dispatch(moveCards(selection.stack, stack, selection.stackCard))\n      }\n    }\n\n    if (stack.type === StackType.stock) {\n      if (disallowClickStock(getState())) return\n      if (selection) dispatch(deselectCard())\n      const waste = getWaste(getState())\n      const stock = getStock(getState())\n      dispatch(checkpoint())\n      if (stock.cards.length > 0) {\n        dispatch(drawStockCards({ stock, waste }))\n      } else {\n        dispatch(recycleWaste({ stock, waste }))\n        dispatch(incrementDraws())\n      }\n    }\n  }\n\nexport const doubleClickCard =\n  (cardSelection: CardSelection): AppThunk =>\n  (dispatch) => {\n    const { stack, stackCard } = cardSelection\n    if (\n      stack.type === StackType.foundation ||\n      stack.type === StackType.stock ||\n      stackCard == null ||\n      stackCard.card == null\n    ) {\n      return\n    }\n\n    dispatch(checkAndPerformFoundationMove({ stack, stackCard }))\n  }\n","import { createAction } from '@reduxjs/toolkit'\nimport { Reducer, AnyAction } from 'redux'\n\ntype History<State> = {\n  past: State[]\n  present: State\n  future: State[]\n}\n\nexport const destroy = createAction('destroy')\nexport const undo = createAction('undo')\nexport const redo = createAction('redo')\nexport const checkpoint = createAction('checkpoint')\n\nexport const undoable = <S, A extends AnyAction>(reducer: Reducer<S, A>) => {\n  const initialState: History<S> = {\n    past: [],\n    present: reducer(void 0, {} as A),\n    future: [],\n  }\n\n  return (state = initialState, action: A) => {\n    const { past, present, future } = state\n\n    if (undo.match(action)) {\n      const previous = past[past.length - 1]\n      if (!previous) {\n        return state\n      }\n\n      const newPast = past.slice(0, past.length - 1)\n      return {\n        past: newPast,\n        present: previous,\n        future: [present, ...future],\n      }\n    }\n\n    if (redo.match(action)) {\n      const next = future[0]\n      if (!next) {\n        return state\n      }\n\n      const newFuture = future.slice(1)\n      return {\n        past: [...past, present],\n        present: next,\n        future: newFuture,\n      }\n    }\n\n    const newPresent = reducer(present, action)\n\n    if (destroy.match(action)) {\n      return {\n        past: [],\n        present: newPresent,\n        future: [],\n      }\n    }\n\n    if (checkpoint.match(action)) {\n      return {\n        past: [...past, present],\n        present: newPresent,\n        future: [],\n      }\n    }\n\n    if (present === newPresent) {\n      return state\n    }\n\n    return {\n      past,\n      present: newPresent,\n      future,\n    }\n  }\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","// no baseURI\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t604: 0\n};\n\n// no chunk on demand loading\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\n__webpack_require__.O.j = (chunkId) => (installedChunks[chunkId] === 0);\n\n// install a JSONP callback for chunk loading\nvar webpackJsonpCallback = (parentChunkLoadingFunction, data) => {\n\tvar [chunkIds, moreModules, runtime] = data;\n\t// add \"moreModules\" to the modules object,\n\t// then flag all \"chunkIds\" as loaded and fire callback\n\tvar moduleId, chunkId, i = 0;\n\tfor(moduleId in moreModules) {\n\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t}\n\t}\n\tif(runtime) var result = runtime(__webpack_require__);\n\tif(parentChunkLoadingFunction) parentChunkLoadingFunction(data);\n\tfor(;i < chunkIds.length; i++) {\n\t\tchunkId = chunkIds[i];\n\t\tif(__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {\n\t\t\tinstalledChunks[chunkId][0]();\n\t\t}\n\t\tinstalledChunks[chunkIds[i]] = 0;\n\t}\n\treturn __webpack_require__.O(result);\n}\n\nvar chunkLoadingGlobal = self[\"webpackChunkklondike\"] = self[\"webpackChunkklondike\"] || [];\nchunkLoadingGlobal.forEach(webpackJsonpCallback.bind(null, 0));\nchunkLoadingGlobal.push = webpackJsonpCallback.bind(null, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));","// startup\n// Load entry module and return exports\n// This entry module depends on other loaded chunks and execution need to be delayed\nvar __webpack_exports__ = __webpack_require__.O(undefined, [163], () => (__webpack_require__(70)))\n__webpack_exports__ = __webpack_require__.O(__webpack_exports__);\n"],"sourceRoot":""}